{"version":3,"sources":["markeditor.js"],"names":["setLog","undoLog","length","editor","value","shift","article","body","articleStorage","JSON","stringify","articleSource","localStorage","setItem","timer","setTimeout","inputTitle","document","getElementById","$editor","$","preview","$preview","md","markdownit","highlight","str","lang","hljs","getLanguage","__","$undo","$redo","redoLog","$showDouble","$showEditor","$showPreview","$articleList","articleSpare","title","date","getItem","parse","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","innerHTML","render","saveArticle","height","clientHeight","window","resize","on","attr","css","$divs","handleScroll","$other","not","this","off","other","get","percentage","scrollTop","scrollHeight","offsetHeight","addEventListener","replace","match","substring","find","html","click","clearTimeout","push","removeClass","prepend","children","i","is","name","blob","Blob","type","saveAs","navigator","saveBlob","url","URL","createObjectURL","link","createElement","setAttribute","event","createEvent","initMouseEvent","dispatchEvent","pop","val","blur","redoTxt","display","width","preventDefault","stopPropagation","reader","FileReader","onload","evt","target","result","readAsText","dataTransfer","files","articleItem","append","addClass","$target","confirm","$targetLi","parent","next","prev","remove","splice"],"mappings":"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","file":"../main.min.js","sourcesContent":["/*\n一些初始化\n*/\n\n// 标题输入区\nvar inputTitle = document.getElementById('input-title');\n// 编辑区\nvar editor = document.getElementById('code');\nvar $editor = $(editor);\n// 预览区\nvar preview = document.getElementById('preview');\nvar $preview = $(preview);\n// 创建markdown转换对象并设置代码高亮\nvar md = markdownit({\n    highlight: function(str, lang) {\n        if (lang && hljs.getLanguage(lang)) {\n            try {\n                return hljs.highlight(lang, str).value;\n            } catch (__) {}\n        }\n        return '';\n    }\n});\n// 自动保存定时器\nvar timer;\n// undo redo按钮\nvar $undo = $('.undo');\nvar $redo = $('.redo');\n// undo redo 记录栈\nvar undoLog = [];\nvar redoLog = [];\n// 区域显示按钮\nvar $showDouble = $('.show-double');\nvar $showEditor = $('.show-editor');\nvar $showPreview = $('.show-preview');\n// 文章列表\nvar $articleList = $('.article-list');\n// 备用文章\narticleSpare = JSON.stringify([\n        { title: '文章1', body: '# 文章1', date: '2016-5-20 20:41:48' },\n        { title: '文章2', body: '# 文章2', date: '2016-5-20 20:41:49' }]\n);\n// 获取本地存储文章\nvar articleStorage = localStorage.getItem('article') || articleSpare;\nvar articleSource = JSON.parse(articleStorage);\n// 选择最近一次编辑的文章作为当前文章\nvar article = articleSource[articleSource.length - 1];\n// 重新编辑设置日期\nvar now = new Date();\narticle.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n// 设置标题，编辑区和预览区\ninputTitle.value = article.title;\neditor.value = article.body;\npreview.innerHTML = md.render(editor.value);\n\n\n// 将文章保存到本地\nvar  saveArticle = function() {\n    articleStorage = JSON.stringify(articleSource);\n    localStorage.setItem('article', articleStorage);\n}\n\n\n// 动态设置主区域高度\n$('#main').height(document.body.clientHeight - 60);\n$(window).resize(function() {\n    $('#main').height(document.body.clientHeight - 60);\n});\n\n\n// 实时预览\n$editor.on('input propertychange', function() {\n    preview.innerHTML = md.render(editor.value);\n    // redo不可用 undo可用\n    redoLog = [];\n    $redo.attr('disabled', true).css('background-color', '#555');\n    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n\n// 编辑区和预览区设置同步滚动\nvar $divs = $('#code, #preview');\nvar handleScroll = function() {\n    // 移除另一个区域的滚动事件 防止循环滚动\n    var $other = $divs.not(this).off('scroll');\n    var other = $other.get(0);\n    // 滚动大小按内容百分比计算\n    var percentage = this.scrollTop / (this.scrollHeight - this.offsetHeight);\n    other.scrollTop = percentage * (other.scrollHeight - other.offsetHeight);\n    // 恢复另一个区域的滚动事件\n    setTimeout(function() {\n        $other.on('scroll', handleScroll);\n    }, 200);\n}\n$divs.on('scroll', handleScroll);\n\n\n// 记录标题变动\ninputTitle.addEventListener('change', function() {\n    // 若输入为空则取日期为标题\n    article.title = inputTitle.value || article.date;\n    // XSS输入过滤\n    article.title = article.title.replace(/[<>'&]/g, function(match) {\n            switch (match) {\n                case '<':\n                    return '&lt;';\n                case '>':\n                    return '&gt;';\n                case '&':\n                    return '&amp;';\n                case '\\'':\n                    return '&quot;';\n         }\n     });\n    // 长标题截短\n    var title = article.title;\n    title  = (title.length < 11) ? title : title.substring(0, 10) + '...';\n    $articleList.find('li[alt=\"' + article.date + '\"]').html(title + '<a class=\"delete\" title=\"删除文章\"></a>');\n    saveArticle();\n});\n\n\n// 定时记录编辑区并自动保存\nfunction setLog() {\n    if (undoLog[undoLog.length - 1] !== editor.value) {\n        // 防止存储数据栈过深\n        if (undoLog.length > 50) {\n            undoLog.shift();\n        }\n        undoLog[undoLog.length] = editor.value;\n        article.body = editor.value;\n        articleStorage = JSON.stringify(articleSource);\n        localStorage.setItem('article', articleStorage);\n    }\n    timer = setTimeout(setLog, 800);\n}\nsetLog();\n\n\n/*\n工具栏\n*/\n\n// 新建文章\n$('.new-article').click(function() {\n    // 关闭自动保存\n    clearTimeout(timer);\n    // 清除记录栈\n    undoLog = [];\n    redoLog = [];\n    $undo.attr('disabled', true).css('background-color', '#555');\n    $redo.attr('disabled', true).css('background-color', '#555');\n    article = { title: '新建文章', body: '', date: '' };\n    articleSource.push(article);\n    // 设置日期\n    var now = new Date();\n    article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n    // 设置标题，编辑区和预览区\n    inputTitle.value = article.title;\n    editor.value = article.body;\n    preview.innerHTML = md.render(editor.value);\n    // 添加到文章列表\n    $('.active').removeClass('active');\n    $articleList.prepend('<li class=\"active\" alt=\"' + article.date + '\" title=\"选择文章\">' + article.title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n    // 重启自动保存\n    setLog();\n});\n\n// 删除当前文章\n$('.del-article').click(function() {\n    var date = article.date;\n    var length = $articleList.children().length;\n    for (var i = 0; i < length; i++) {\n        if ($($articleList.children()[i]).is('.active')) {\n            $($articleList.children()[i]).find('.delete').click();\n        }\n    }\n});\n\n// 保存文章到本地\n$('.down-article').click(function() {\n    var name = article.title + '.md';\n    var blob = new Blob([article.body], {type: 'text/plain'});\n    if (window.saveAs) {\n        // IE\n        window.saveAs(blob, name);\n    } else if (navigator.saveBlob) {\n        // IE\n        navigator.saveBlob(blob, name);\n    } else {\n        // Chrome Firefox\n        url = URL.createObjectURL(blob);\n        var link = document.createElement(\"a\");\n        link.setAttribute('href', url);\n        link.setAttribute('download', name);\n        // 点击下载事件模拟\n        var event = document.createEvent('MouseEvents');\n        event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n        link.dispatchEvent(event);\n    }\n});\n\n// undo\n$undo.click(function() {\n    redoLog.push(undoLog.pop());\n    $editor.val(undoLog[undoLog.length - 1]).blur();\n    // 当记录栈没有内容时，设置按钮不可用\n    if (!undoLog[undoLog.length - 1]) {\n        $undo.attr('disabled', true).css('background-color', '#555');\n    }\n    $redo.attr('disabled', false).css('background-color', '#fcfcfc');\n    preview.innerHTML = md.render(editor.value);\n    article.body = editor.value;\n    saveArticle();\n});\n\n// redo\n$redo.click(function() {\n    var redoTxt = redoLog.pop();\n    undoLog.push(redoTxt);\n    // 当记录栈没有内容时，设置按钮不可用\n    if (!redoLog[redoLog.length - 1]) {\n        $redo.attr('disabled', true).css('background-color', '#555');\n    }\n    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n    $editor.val(redoTxt).blur();\n    preview.innerHTML = md.render(editor.value);\n    article.body = editor.value;\n    saveArticle();\n});\n\n// 双屏显示\n$showDouble.click(function() {\n    $editor.css({'display': 'block', 'width': '48%'});\n    $preview.css({'display': 'block', 'width': '52%'});\n    $showDouble.attr('disabled', true).css('background-color', '#555');\n    $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n    $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n// 只显示编辑区\n$showEditor.click(function() {\n    $editor.css({'display': 'block', 'width': '100%'});\n    $preview.css({'display': 'none', 'width': '0%'});\n    $showEditor.attr('disabled', true).css('background-color', '#555');\n    $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n    $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n// 只显示预览区\n$showPreview.click(function() {\n    $editor.css({'display': 'none', 'width': '0%'});\n    $preview.css({'display': 'block', 'width': '100%'});\n    $showPreview.attr('disabled', true).css('background-color', '#555');\n    $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n    $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n// 语法提示\n$('.show-tips').click(function() {\n    if ($('.tips').css('display') === 'none') {\n        $('.tips').css('display', 'block');\n    } else {\n        $('.tips').css('display', 'none');\n    }\n});\n\n// 文件拖拽上传\ndocument.addEventListener('drop', function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    // 文件读取API\n    var reader = new FileReader();\n    reader.onload = function(evt) {\n        // 创建新文章并初始化\n        $('.new-article').click();\n        editor.value = evt.target.result;\n        article.body = editor.value;\n        preview.innerHTML = md.render(editor.value);\n        saveArticle();\n    };\n    reader.readAsText(event.dataTransfer.files[0]);\n}, false);\n\n\n/*\n侧边栏\n*/\n\n// 初始化文章列表\n(function() {\n    for (var i = articleSource.length - 1; i >= 0; i--) {\n        var articleItem = articleSource[i];\n        // 长标题截短\n        var title = articleItem.title;\n        title  = (title.length < 11) ? title : title.substring(0, 10) + '...';\n        $articleList.append('<li alt=\"' + articleItem.date + '\" title=\"选择文章\">' + title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n    }\n    $('.article-list li:first-child').addClass('active');\n})();\n\n\n// 显示文章列表\n$('#show-article').click(function() {\n    if ($('.aside').css('left') === '0px') {\n        $('#show-article').css('background-image', 'url(../img/arrow_right.png)');\n        $('.aside').css('left', '-250px');\n        $('#show-article').css('left', '0px');\n        $('.modal').css('display', 'none');\n        $('.wrapper').css('left', '0px');\n        // 重启自动保存\n        setLog();\n    } else {\n        $('#show-article').css('background-image', 'url(../img/arrow_left.png)');\n        $('.aside').css('left', '0px');\n        $('#show-article').css('left', '250px');\n        $('.modal').css('display', 'block');\n        $('.wrapper').css('left', '250px');\n        // 关闭自动保存\n        clearTimeout(timer);\n    }\n});\n\n// 删除和选择文章事件\n$articleList.click(function(event) {\n    var $target = $(event.target);\n    if ($target.is('.delete')) {\n        if (confirm('确定要删除此文章吗?')) {\n            // 获取父元素\n            var $targetLi = $target.parent('li');\n            // 如果删除的是当前编辑文章\n            if ($targetLi.is('.active')) {\n                // 切换到其他文章\n                if ($targetLi.next().is('li')) {\n                    $targetLi.next().click();\n                } else if ($targetLi.prev().is('li')) {\n                    $targetLi.prev().click();\n                } else {\n                    // 若无其他文章则新建\n                    $('.new-article').click();\n                }\n            }\n            // 根据日期查找文章\n            var date = $targetLi.attr('alt');\n            $targetLi.remove();\n            for (var i = 0; i < articleSource.length; i++) {\n                if (articleSource[i].date === date) {\n                    articleSource.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    } else if ($target.is('li') && !$target.is('.active')) {\n        // 清除记录栈\n        undoLog = [];\n        redoLog = [];\n        $undo.attr('disabled', true).css('background-color', '#555');\n        $redo.attr('disabled', true).css('background-color', '#555');\n        var date = $target.attr('alt');\n        $('.active').removeClass('active');\n        $target.addClass('active');\n        for (var i = 0; i < articleSource.length; i++) {\n            if (articleSource[i].date === date) {\n                // 将选择的文章放入列表底部\n                article = articleSource[i];\n                articleSource.push(articleSource[i]);\n                articleSource.splice(i, 1);\n                // 重新编辑设置日期\n                var now = new Date();\n                article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n                $target.attr('alt', article.date);\n                // 设置标题，编辑区和预览区\n                inputTitle.value = article.title;\n                editor.value = article.body;\n                preview.innerHTML = md.render(editor.value);\n                break;\n            }\n        }\n    }\n    saveArticle();\n});"]}