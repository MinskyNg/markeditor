{"version":3,"sources":["markeditor.js"],"names":["inputTitle","document","getElementById","editor","$editor","$","preview","$preview","md","markdownit","highlight","str","lang","hljs","getLanguage","value","__","timer","$undo","$redo","undoLog","redoLog","$showDouble","$showEditor","$showPreview","$toolbar","$formWrapper","$articleList","articleSpare","JSON","stringify","title","body","date","articleStorage","localStorage","getItem","articleSource","parse","article","length","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","innerHTML","render","saveArticle","setItem","height","clientHeight","window","resize","on","attr","css","$divs","handleScroll","$other","not","this","off","other","get","percentage","scrollTop","scrollHeight","offsetHeight","setTimeout","addEventListener","replace","match","substring","find","html","setLog","shift","event","keyCode","which","start","selectionStart","end","selectionEnd","preventDefault","click","clearTimeout","push","removeClass","prepend","children","i","is","name","blob","Blob","type","saveAs","navigator","saveBlob","url","URL","createObjectURL","link","createElement","setAttribute","createEvent","initMouseEvent","dispatchEvent","pop","val","blur","redoTxt","display","width","stopPropagation","reader","FileReader","onload","evt","target","result","readAsText","dataTransfer","files","insertText","text","selection","sel","createRange","startPos","endPos","cursorPos","tmpText","getAddress","$target","word","address","keydown","articleItem","append","addClass","confirm","$targetLi","parent","next","prev","remove","splice"],"mappings":"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","file":"../main.min.js","sourcesContent":["/*\n一些初始化\n*/\n\n// 标题输入区\nvar inputTitle = document.getElementById('input-title');\n// 编辑区\nvar editor = document.getElementById('editor');\nvar $editor = $(editor);\n// 预览区\nvar preview = document.getElementById('preview');\nvar $preview = $(preview);\n// 创建markdown转换对象并设置代码高亮\nvar md = markdownit({\n    highlight: function(str, lang) {\n        if (lang && hljs.getLanguage(lang)) {\n            try {\n                return hljs.highlight(lang, str).value;\n            } catch (__) {}\n        }\n        return '';\n    }\n});\n// 自动保存定时器\nvar timer;\n// undo redo按钮\nvar $undo = $('.undo');\nvar $redo = $('.redo');\n// undo redo 记录栈\nvar undoLog = [];\nvar redoLog = [];\n// 区域显示按钮\nvar $showDouble = $('.show-double');\nvar $showEditor = $('.show-editor');\nvar $showPreview = $('.show-preview');\n// 浮动工具栏\nvar $toolbar = $('.toolbar');\n// 弹出层\nvar $formWrapper = $('.form-wrapper');\n// 文章列表\nvar $articleList = $('.article-list');\n\n\n// 备用文章\narticleSpare = JSON.stringify([{\n    title: '文章1',\n    body: '# 文章1',\n    date: '2016-5-20 20:41:48'\n}, {\n    title: '文章2',\n    body: '# 文章2',\n    date: '2016-5-20 20:41:49'\n}]);\n// 获取本地存储文章\nvar articleStorage = localStorage.getItem('article') || articleSpare;\nvar articleSource = JSON.parse(articleStorage);\n// 选择最近一次编辑的文章作为当前文章\nvar article = articleSource[articleSource.length - 1];\n// 重新编辑设置日期\nvar now = new Date();\narticle.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n// 设置标题，编辑区和预览区\ninputTitle.value = article.title;\neditor.value = article.body;\npreview.innerHTML = md.render(editor.value);\n\n\n// 将文章保存到本地\nvar saveArticle = function() {\n    articleStorage = JSON.stringify(articleSource);\n    localStorage.setItem('article', articleStorage);\n};\n\n\n// 动态设置主区域高度\n$('#main').height(document.body.clientHeight - 60);\n$(window).resize(function() {\n    $('#main').height(document.body.clientHeight - 60);\n});\n\n\n// 实时预览\n$editor.on('input propertychange', function() {\n    preview.innerHTML = md.render(editor.value);\n    // redo不可用 undo可用\n    redoLog = [];\n    $redo.attr('disabled', true).css('background-color', '#555');\n    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n\n// 编辑区和预览区设置同步滚动\nvar $divs = $('#editor, #preview');\nvar handleScroll = function() {\n    // 移除另一个区域的滚动事件 防止循环滚动\n    var $other = $divs.not(this).off('scroll');\n    var other = $other.get(0);\n    // 滚动大小按内容百分比计算\n    var percentage = this.scrollTop / (this.scrollHeight - this.offsetHeight);\n    other.scrollTop = percentage * (other.scrollHeight - other.offsetHeight);\n    // 恢复另一个区域的滚动事件\n    setTimeout(function() {\n        $other.on('scroll', handleScroll);\n    }, 200);\n}\n$divs.on('scroll', handleScroll);\n\n\n// 记录标题变动\ninputTitle.addEventListener('change', function() {\n    // 去除前后空格并做XSS输入过滤\n    article.title = inputTitle.value.replace(/(^\\s*)|(\\s*$)/g, '').replace(/[<>'&]/g, function(match) {\n        switch (match) {\n            case '<':\n                return '&lt;';\n            case '>':\n                return '&gt;';\n            case '&':\n                return '&amp;';\n            case '\\'':\n                return '&quot;';\n        }\n    });\n    // 若输入为空则取日期为标题\n    article.title = article.title || article.date;\n    // 长标题截短\n    var title = article.title;\n    title = (title.length < 11) ? title : title.substring(0, 10) + '...';\n    $articleList.find('li[alt=\"' + article.date + '\"]').html(title + '<a class=\"delete\" title=\"删除文章\"></a>');\n    saveArticle();\n});\n\n\n// 定时记录编辑区并自动保存\nvar setLog = function() {\n    if (undoLog[undoLog.length - 1] !== editor.value) {\n        // 防止存储数据栈过深\n        if (undoLog.length > 50) {\n            undoLog.shift();\n        }\n        undoLog[undoLog.length] = editor.value;\n        article.body = editor.value;\n        articleStorage = JSON.stringify(articleSource);\n        localStorage.setItem('article', articleStorage);\n    }\n    timer = setTimeout(setLog, 800);\n};\nsetLog();\n\n\n// 阻止tab键切换文本框\neditor.addEventListener('keydown', function(event) {\n    var keyCode = event.keyCode || event.which;\n    // 如果按下tab键\n    if (keyCode === 9) {\n        var start = editor.selectionStart,\n            end = editor.selectionEnd;\n        editor.value = editor.value.substring(0, start) + '\\t' + editor.value.substring(end);\n        editor.selectionStart = editor.selectionEnd = start + 1;\n        // 阻止默认事件\n        event.preventDefault();\n        $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n        preview.innerHTML = md.render(editor.value);\n    }\n});\n\n\n/*\n导航栏\n*/\n\n// 新建文章\n$('.new-article').click(function() {\n    // 关闭自动保存\n    clearTimeout(timer);\n    // 清除记录栈\n    undoLog = [];\n    redoLog = [];\n    $undo.attr('disabled', true).css('background-color', '#555');\n    $redo.attr('disabled', true).css('background-color', '#555');\n    article = {\n        title: '新建文章',\n        body: '',\n        date: ''\n    };\n    articleSource.push(article);\n    // 设置日期\n    var now = new Date();\n    article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n    // 设置标题，编辑区和预览区\n    inputTitle.value = article.title;\n    editor.value = article.body;\n    preview.innerHTML = md.render(editor.value);\n    // 添加到文章列表\n    $('.active').removeClass('active');\n    $articleList.prepend('<li class=\"active\" alt=\"' + article.date + '\" title=\"选择文章\">' + article.title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n    // 重启自动保存\n    setLog();\n});\n\n// 删除当前文章\n$('.del-article').click(function() {\n    var date = article.date;\n    var length = $articleList.children().length;\n    for (var i = 0; i < length; i++) {\n        if ($($articleList.children()[i]).is('.active')) {\n            $($articleList.children()[i]).find('.delete').click();\n        }\n    }\n});\n\n// 下载文章\n$('.down-article').click(function() {\n    var name = article.title + '.md';\n    var blob = new Blob([article.body], {\n        type: 'text/plain'\n    });\n    if (window.saveAs) {\n        // IE\n        window.saveAs(blob, name);\n    } else if (navigator.saveBlob) {\n        // IE\n        navigator.saveBlob(blob, name);\n    } else {\n        // 非IE\n        url = URL.createObjectURL(blob);\n        var link = document.createElement(\"a\");\n        link.setAttribute('href', url);\n        link.setAttribute('download', name);\n        // 模拟点击下载事件\n        var event = document.createEvent('MouseEvents');\n        event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n        link.dispatchEvent(event);\n    }\n});\n\n// undo\n$undo.click(function() {\n    redoLog.push(undoLog.pop());\n    $editor.val(undoLog[undoLog.length - 1]).blur();\n    // 当记录栈没有内容时，设置按钮不可用\n    if (!undoLog[undoLog.length - 1]) {\n        $undo.attr('disabled', true).css('background-color', '#555');\n    }\n    $redo.attr('disabled', false).css('background-color', '#fcfcfc');\n    preview.innerHTML = md.render(editor.value);\n    article.body = editor.value;\n    saveArticle();\n});\n\n// redo\n$redo.click(function() {\n    var redoTxt = redoLog.pop();\n    undoLog.push(redoTxt);\n    // 当记录栈没有内容时，设置按钮不可用\n    if (!redoLog[redoLog.length - 1]) {\n        $redo.attr('disabled', true).css('background-color', '#555');\n    }\n    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n    $editor.val(redoTxt).blur();\n    preview.innerHTML = md.render(editor.value);\n    article.body = editor.value;\n    saveArticle();\n});\n\n// 双屏显示\n$showDouble.click(function() {\n    $editor.css({\n        'display': 'block',\n        'width': '48%'\n    });\n    $preview.css({\n        'display': 'block',\n        'width': '52%'\n    });\n    $toolbar.css('display', 'block');\n    $showDouble.attr('disabled', true).css('background-color', '#555');\n    $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n    $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n// 只显示编辑区\n$showEditor.click(function() {\n    $editor.css({\n        'display': 'block',\n        'width': '100%'\n    });\n    $preview.css({\n        'display': 'none',\n        'width': '0%'\n    });\n    $toolbar.css('display', 'block');\n    $showEditor.attr('disabled', true).css('background-color', '#555');\n    $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n    $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n// 只显示预览区\n$showPreview.click(function() {\n    $editor.css({\n        'display': 'none',\n        'width': '0%'\n    });\n    $preview.css({\n        'display': 'block',\n        'width': '100%'\n    });\n    $toolbar.css('display', 'none');\n    $showPreview.attr('disabled', true).css('background-color', '#555');\n    $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n    $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n// 语法提示\n$('.show-tips').click(function() {\n    if ($('.tips').css('display') === 'none') {\n        $('.tips').css('display', 'block');\n    } else {\n        $('.tips').css('display', 'none');\n    }\n});\n\n// 文件拖拽上传\ndocument.addEventListener('drop', function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    // 文件读取API\n    var reader = new FileReader();\n    reader.onload = function(evt) {\n        // 创建新文章并初始化\n        $('.new-article').click();\n        editor.value = evt.target.result;\n        article.body = editor.value;\n        preview.innerHTML = md.render(editor.value);\n        saveArticle();\n    };\n    reader.readAsText(event.dataTransfer.files[0]);\n}, false);\n\n\n/*\n浮动工具栏\n*/\n\n// 在光标处插入文本\nvar insertText = function(text) {\n    // IE\n    if (document.selection) {\n        var sel = document.selection.createRange();\n        sel.text = text;\n        // 非IE\n    } else if (typeof editor.selectionStart === 'number' && typeof editor.selectionEnd === 'number') {\n        // 获取文本起始点和结束点\n        var startPos = editor.selectionStart;\n        var endPos = editor.selectionEnd;\n        var cursorPos = startPos;\n        // 插入文本\n        var tmpText = editor.value;\n        editor.value = tmpText.substring(0, startPos) + text + tmpText.substring(endPos, tmpText.length);\n        // 移动光标\n        cursorPos += text.length;\n        editor.selectionStart = editor.selectionEnd = cursorPos;\n    } else {\n        editor.value += text;\n    }\n};\n\n// 获取链接和图片地址\nvar getAddress = function(type) {\n    // 弹出表单\n    $formWrapper.css('display', 'block');\n    // 表单点击事件\n    $formWrapper.click(function(event) {\n        var $target = $(event.target);\n        if ($target.is('.cancel')) {\n            $('.form-wrapper input').val('');\n            $formWrapper.css('display', 'none');\n            $formWrapper.off('click keydown');\n        } else if ($target.is('.submit')) {\n            var word = $('.input-word').val().replace(/(^\\s*)|(\\s*$)/g, '');\n            var address = $('.input-address').val().replace(/(^\\s*)|(\\s*$)/g, '');\n            if (type === 'img') {\n                insertText('![' + word + ']' + '(' + address + ')');\n            } else {\n                insertText('[' + word + ']' + '(' + address + ')');\n            }\n            $('.form-wrapper input').val('');\n            $formWrapper.css('display', 'none');\n            $formWrapper.off('click keydown');\n        }\n        $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n        preview.innerHTML = md.render(editor.value);\n        event.preventDefault();\n    });\n\n    // 回车提交事件\n    $formWrapper.keydown(function(event) {\n        var keyCode = event.keyCode || event.which;\n        // 如果按下回车键\n        if (keyCode === 13) {\n            var word = $('.input-word').val().replace(/(^\\s*)|(\\s*$)/g, '');\n            var address = $('.input-address').val().replace(/(^\\s*)|(\\s*$)/g, '');\n            if (type === 'img') {\n                insertText('![' + word + ']' + '(' + address + ')');\n            } else {\n                insertText('[' + word + ']' + '(' + address + ')');\n            }\n            $('.form-wrapper input').val('');\n            $formWrapper.css('display', 'none');\n            $formWrapper.off('click keydown');\n            preview.innerHTML = md.render(editor.value);\n            event.preventDefault();\n        }\n    });\n};\n\n\n// 根据不同按钮向textarea插入文本\n$toolbar.click(function(event) {\n    var $target = $(event.target);\n    switch ($target.attr('class')) {\n        case 'add-heading':\n            insertText('## 标题');\n            break;\n        case 'add-strong':\n            insertText('**粗体**');\n            break;\n        case 'add-italic':\n            insertText('*斜体*');\n            break;\n        case 'add-code':\n            insertText('\\t输入代码');\n            break;\n        case 'add-link':\n            getAddress('link');\n            break;\n        case 'add-img':\n            getAddress('img');\n            break;\n        case 'add-ul':\n            insertText('* 列表项');\n            break;\n        case 'add-ol':\n            insertText('1. 列表项');\n            break;\n        case 'add-quote':\n            insertText('> 块引用');\n            break;\n        case 'add-line':\n            insertText('----------');\n            break;\n    }\n    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n    preview.innerHTML = md.render(editor.value);\n});\n\n\n/*\n侧边栏\n*/\n\n// 初始化文章列表\n(function() {\n    for (var i = articleSource.length - 1; i >= 0; i--) {\n        var articleItem = articleSource[i];\n        // 长标题截短\n        var title = articleItem.title;\n        title = (title.length < 11) ? title : title.substring(0, 10) + '...';\n        $articleList.append('<li alt=\"' + articleItem.date + '\" title=\"选择文章\">' + title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n    }\n    $('.article-list li:first-child').addClass('active');\n})();\n\n\n// 显示文章列表\n$('#show-article').click(function() {\n    if ($('.aside').css('left') === '0px') {\n        $('#show-article').css('background-image', 'url(../img/arrow_right.png)');\n        $('.aside').css('left', '-250px');\n        $('#show-article').css('left', '0px');\n        $('.modal').css('display', 'none');\n        $('.wrapper').css('left', '0px');\n        // 重启自动保存\n        setLog();\n    } else {\n        $('#show-article').css('background-image', 'url(../img/arrow_left.png)');\n        $('.aside').css('left', '0px');\n        $('#show-article').css('left', '250px');\n        $('.modal').css('display', 'block');\n        $('.wrapper').css('left', '250px');\n        // 关闭自动保存\n        clearTimeout(timer);\n    }\n});\n\n// 删除和选择文章事件\n$articleList.click(function(event) {\n    var $target = $(event.target);\n    if ($target.is('.delete')) {\n        if (confirm('确定要删除此文章吗?')) {\n            // 获取父元素\n            var $targetLi = $target.parent('li');\n            // 如果删除的是当前编辑文章\n            if ($targetLi.is('.active')) {\n                // 切换到其他文章\n                if ($targetLi.next().is('li')) {\n                    $targetLi.next().click();\n                } else if ($targetLi.prev().is('li')) {\n                    $targetLi.prev().click();\n                } else {\n                    // 若无其他文章则新建\n                    $('.new-article').click();\n                }\n            }\n            // 根据日期查找文章\n            var date = $targetLi.attr('alt');\n            $targetLi.remove();\n            for (var i = 0; i < articleSource.length; i++) {\n                if (articleSource[i].date === date) {\n                    articleSource.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    } else if ($target.is('li') && !$target.is('.active')) {\n        // 清除记录栈\n        undoLog = [];\n        redoLog = [];\n        $undo.attr('disabled', true).css('background-color', '#555');\n        $redo.attr('disabled', true).css('background-color', '#555');\n        var date = $target.attr('alt');\n        $('.active').removeClass('active');\n        $target.addClass('active');\n        for (var i = 0; i < articleSource.length; i++) {\n            if (articleSource[i].date === date) {\n                // 将选择的文章放入列表底部\n                article = articleSource[i];\n                articleSource.push(articleSource[i]);\n                articleSource.splice(i, 1);\n                // 重新编辑设置日期\n                var now = new Date();\n                article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n                $target.attr('alt', article.date);\n                // 设置标题，编辑区和预览区\n                inputTitle.value = article.title;\n                editor.value = article.body;\n                preview.innerHTML = md.render(editor.value);\n                break;\n            }\n        }\n    }\n    saveArticle();\n});"]}