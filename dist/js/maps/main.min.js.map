{"version":3,"sources":["markeditor.js"],"names":["inputTitle","document","getElementById","editor","$editor","$","preview","$preview","md","markdownit","highlight","str","lang","hljs","getLanguage","value","__","timer","$undo","$redo","undoLog","redoLog","$showDouble","$showEditor","$showPreview","$toolbar","$formWrapper","$articleList","regTrim","articleSpare","JSON","stringify","title","body","date","articleStorage","localStorage","getItem","articleSource","parse","article","length","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","innerHTML","render","saveArticle","setItem","style","height","clientHeight","window","addEventListener","on","attr","css","handleScroll","other","this","removeEventListener","percentage","scrollTop","scrollHeight","offsetHeight","setTimeout","setLog","shift","event","keyCode","which","start","selectionStart","end","selectionEnd","substring","preventDefault","stopPropagation","reader","FileReader","onload","evt","click","target","result","readAsText","dataTransfer","files","replace","match","find","html","$target","clearTimeout","push","removeClass","prepend","children","i","is","name","blob","Blob","type","saveAs","navigator","saveBlob","url","URL","createObjectURL","link","createElement","setAttribute","createEvent","initMouseEvent","dispatchEvent","pop","val","blur","redoTxt","display","width","insertText","text","selection","sel","createRange","startPos","endPos","cursorPos","tmpText","focus","getAddress","off","word","address","keydown","articleItem","append","addClass","confirm","$targetLi","parent","next","prev","remove","splice"],"mappings":"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","file":"../main.min.js","sourcesContent":["/*\n一些初始化\n*/\n\n// 标题输入区\nvar inputTitle = document.getElementById('input-title');\n// 编辑区\nvar editor = document.getElementById('editor');\nvar $editor = $(editor);\n// 预览区\nvar preview = document.getElementById('preview');\nvar $preview = $(preview);\n// 创建markdown转换对象并设置代码高亮\nvar md = markdownit({\n    highlight: function(str, lang) {\n        if (lang && hljs.getLanguage(lang)) {\n            try {\n                return hljs.highlight(lang, str).value;\n            } catch (__) {}\n        }\n        return '';\n    }\n});\n// 自动保存定时器\nvar timer;\n// undo redo按钮\nvar $undo = $('.undo');\nvar $redo = $('.redo');\n// undo redo 记录栈\nvar undoLog = [];\nvar redoLog = [];\n// 区域显示按钮\nvar $showDouble = $('.show-double');\nvar $showEditor = $('.show-editor');\nvar $showPreview = $('.show-preview');\n// 浮动工具栏\nvar $toolbar = $('.toolbar');\n// 弹出层\nvar $formWrapper = $('.form-wrapper');\n// 文章列表\nvar $articleList = $('.article-list');\n// 去除前后空格\nvar regTrim = /(^\\s*)|(\\s*$)/g;\n\n\n// 备用文章\narticleSpare = JSON.stringify([{\n    title: '文章1',\n    body: '# 文章1',\n    date: '2016-5-20 20:41:48'\n}, {\n    title: '文章2',\n    body: '# 文章2',\n    date: '2016-5-20 20:41:49'\n}]);\n// 获取本地存储文章\nvar articleStorage = localStorage.getItem('article') || articleSpare;\nvar articleSource = JSON.parse(articleStorage);\n// 选择最近一次编辑的文章作为当前文章\nvar article = articleSource[articleSource.length - 1];\n// 重新编辑设置日期\nvar now = new Date();\narticle.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n// 设置标题，编辑区和预览区\ninputTitle.value = article.title;\neditor.value = article.body;\npreview.innerHTML = md.render(editor.value);\n\n\n// 将文章保存到本地\nvar saveArticle = function() {\n    articleStorage = JSON.stringify(articleSource);\n    localStorage.setItem('article', articleStorage);\n};\n\n\n\n/*\n编辑区和预览区\n*/\n\n// 动态设置主区域高度\ndocument.getElementById('main').style.height = (document.body.clientHeight - 60) + 'px';\nwindow.addEventListener('resize', function() {\n    document.getElementById('main').style.height = (document.body.clientHeight - 60) + 'px';\n});\n\n\n// 实时预览\n$editor.on('input propertychange', function() {\n    preview.innerHTML = md.render(editor.value);\n    // redo不可用 undo可用\n    redoLog = [];\n    $redo.attr('disabled', true).css('background-color', '#555');\n    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n});\n\n\n// 编辑区和预览区设置同步滚动\nvar handleScroll = function() {\n    var other;\n    if (this === editor) {\n        other = preview;\n    } else {\n        other = editor;\n    }\n    // 移除另一个区域的滚动事件 防止循环滚动\n    other.removeEventListener('scroll', handleScroll);\n    // 滚动大小按内容百分比计算\n    var percentage = this.scrollTop / (this.scrollHeight - this.offsetHeight);\n    other.scrollTop = percentage * (other.scrollHeight - other.offsetHeight);\n    // 恢复另一个区域的滚动事件\n    setTimeout(function() {\n        other.addEventListener('scroll', handleScroll);\n    }, 200);\n}\neditor.addEventListener('scroll', handleScroll);\npreview.addEventListener('scroll', handleScroll);\n\n\n// 定时记录编辑区并自动保存\nvar setLog = function() {\n    if (undoLog[undoLog.length - 1] !== editor.value) {\n        // 防止存储数据栈过深\n        if (undoLog.length > 50) {\n            undoLog.shift();\n        }\n        undoLog[undoLog.length] = editor.value;\n        article.body = editor.value;\n        articleStorage = JSON.stringify(articleSource);\n        localStorage.setItem('article', articleStorage);\n    }\n    timer = setTimeout(setLog, 800);\n};\nsetLog();\n\n\n// 阻止tab键切换文本框\neditor.addEventListener('keydown', function(event) {\n    var keyCode = event.keyCode || event.which;\n    // 如果按下tab键\n    if (keyCode === 9) {\n        var start = editor.selectionStart,\n            end = editor.selectionEnd;\n        editor.value = editor.value.substring(0, start) + '\\t' + editor.value.substring(end);\n        editor.selectionStart = editor.selectionEnd = start + 1;\n        // 阻止默认事件\n        event.preventDefault();\n        $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n        preview.innerHTML = md.render(editor.value);\n    }\n});\n\n\n// 文件拖拽上传\ndocument.addEventListener('drop', function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    // 文件读取API\n    var reader = new FileReader();\n    reader.onload = function(evt) {\n        // 创建新文章并初始化\n        $('.new-article').click();\n        editor.value = evt.target.result;\n        article.body = editor.value;\n        preview.innerHTML = md.render(editor.value);\n        saveArticle();\n    };\n    reader.readAsText(event.dataTransfer.files[0]);\n}, false);\n\n\n\n/*\n导航栏\n*/\n\n// 记录标题变动\ninputTitle.addEventListener('change', function() {\n    // 去除前后空格并做XSS输入过滤\n    article.title = inputTitle.value.replace(regTrim, '').replace(/[<>'&]/g, function(match) {\n        switch (match) {\n            case '<':\n                return '&lt;';\n            case '>':\n                return '&gt;';\n            case '&':\n                return '&amp;';\n            case '\\'':\n                return '&quot;';\n        }\n    });\n    // 若输入为空则取日期为标题\n    article.title = article.title || article.date;\n    // 长标题截短\n    var title = article.title;\n    title = (title.length < 11) ? title : title.substring(0, 10) + '...';\n    $articleList.find('li[alt=\"' + article.date + '\"]').html(title + '<a class=\"delete\" title=\"删除文章\"></a>');\n    saveArticle();\n});\n\n\n// 导航栏按钮点击事件\n$('.nav').click(function(event) {\n    var $target = $(event.target);\n    switch ($target.attr('class')) {\n        // 新建文章\n        case 'new-article':\n        case 'icon-new':\n            // 关闭自动保存\n            clearTimeout(timer);\n            // 清除记录栈\n            undoLog = [];\n            redoLog = [];\n            $undo.attr('disabled', true).css('background-color', '#555');\n            $redo.attr('disabled', true).css('background-color', '#555');\n            article = {\n                title: '新建文章',\n                body: '',\n                date: ''\n            };\n            articleSource.push(article);\n            // 设置日期\n            var now = new Date();\n            article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n            // 设置标题，编辑区和预览区\n            inputTitle.value = article.title;\n            editor.value = article.body;\n            preview.innerHTML = md.render(editor.value);\n            // 添加到文章列表\n            $('.active').removeClass('active');\n            $articleList.prepend('<li class=\"active\" alt=\"' + article.date + '\" title=\"选择文章\">' + article.title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n            // 重启自动保存\n            setLog();\n            break;\n            //删除文章\n        case 'del-article':\n        case 'icon-del':\n            var date = article.date;\n            var length = $articleList.children().length;\n            for (var i = 0; i < length; i++) {\n                if ($($articleList.children()[i]).is('.active')) {\n                    $($articleList.children()[i]).find('.delete').click();\n                }\n            }\n            break;\n            // 下载文章\n        case 'down-article':\n        case 'icon-download':\n            var name = article.title + '.md';\n            var blob = new Blob([article.body], {\n                type: 'text/plain'\n            });\n            if (window.saveAs) {\n                // IE\n                window.saveAs(blob, name);\n            } else if (navigator.saveBlob) {\n                // IE\n                navigator.saveBlob(blob, name);\n            } else {\n                // 非IE\n                url = URL.createObjectURL(blob);\n                var link = document.createElement(\"a\");\n                link.setAttribute('href', url);\n                link.setAttribute('download', name);\n                // 模拟点击下载事件\n                var event = document.createEvent('MouseEvents');\n                event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                link.dispatchEvent(event);\n            }\n            break;\n            // 撤销\n        case 'undo':\n        case 'icon-undo':\n            redoLog.push(undoLog.pop());\n            $editor.val(undoLog[undoLog.length - 1]).blur();\n            // 当记录栈没有内容时，设置按钮不可用\n            if (!undoLog[undoLog.length - 1]) {\n                $undo.attr('disabled', true).css('background-color', '#555');\n            }\n            $redo.attr('disabled', false).css('background-color', '#fcfcfc');\n            preview.innerHTML = md.render(editor.value);\n            article.body = editor.value;\n            saveArticle();\n            break;\n            // 恢复\n        case 'redo':\n        case 'icon-redo':\n            var redoTxt = redoLog.pop();\n            undoLog.push(redoTxt);\n            // 当记录栈没有内容时，设置按钮不可用\n            if (!redoLog[redoLog.length - 1]) {\n                $redo.attr('disabled', true).css('background-color', '#555');\n            }\n            $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n            $editor.val(redoTxt).blur();\n            preview.innerHTML = md.render(editor.value);\n            article.body = editor.value;\n            saveArticle();\n            break;\n            // 双屏显示\n        case 'show-double':\n        case 'icon-double':\n            $editor.css({\n                'display': 'block',\n                'width': '48%'\n            });\n            $preview.css({\n                'display': 'block',\n                'width': '52%'\n            });\n            $toolbar.css('display', 'block');\n            $showDouble.attr('disabled', true).css('background-color', '#555');\n            $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n            $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n            break;\n            // 只显示编辑区\n        case 'show-editor':\n        case 'icon-editor':\n            $editor.css({\n                'display': 'block',\n                'width': '100%'\n            });\n            $preview.css({\n                'display': 'none',\n                'width': '0%'\n            });\n            $toolbar.css('display', 'block');\n            $showEditor.attr('disabled', true).css('background-color', '#555');\n            $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n            $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n            break;\n            // 只显示预览区\n        case 'show-preview':\n        case 'icon-preview':\n            $editor.css({\n                'display': 'none',\n                'width': '0%'\n            });\n            $preview.css({\n                'display': 'block',\n                'width': '100%'\n            });\n            $toolbar.css('display', 'none');\n            $showPreview.attr('disabled', true).css('background-color', '#555');\n            $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n            $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n            break;\n            // 显示语法帮助\n        case 'show-tips':\n        case 'icon-tips':\n            if ($('.tips').css('display') === 'none') {\n                $('.tips').css('display', 'block');\n            } else {\n                $('.tips').css('display', 'none');\n            }\n            break;\n    }\n});\n\n\n\n/*\n浮动工具栏\n*/\n\n// 在光标处插入文本\nvar insertText = function(text) {\n    // IE\n    if (document.selection) {\n        var sel = document.selection.createRange();\n        sel.text = text;\n    // 非IE\n    } else if (typeof editor.selectionStart === 'number' && typeof editor.selectionEnd === 'number') {\n        // 获取文本起始点和结束点\n        var startPos = editor.selectionStart;\n        var endPos = editor.selectionEnd;\n        var cursorPos = startPos;\n        // 插入文本\n        var tmpText = editor.value;\n        editor.value = tmpText.substring(0, startPos) + text + tmpText.substring(endPos, tmpText.length);\n        // 移动光标\n        cursorPos += text.length;\n        // 改变选中区域\n        if (text === '## 请输入标题') {\n            editor.selectionStart = cursorPos - 5;\n            editor.selectionEnd = cursorPos;\n        } else if (text === '**请输入文字**') {\n            editor.selectionStart = cursorPos - 7;\n            editor.selectionEnd = cursorPos - 2;\n        } else if (text === '*请输入文字*') {\n            editor.selectionStart = cursorPos - 6;\n            editor.selectionEnd = cursorPos - 1;\n        } else if (text === '\\t 请输入代码') {\n            editor.selectionStart = cursorPos - 5;\n            editor.selectionEnd = cursorPos;\n        } else if (text === '* 请输入列表项') {\n            editor.selectionStart = cursorPos - 6;\n            editor.selectionEnd = cursorPos;\n        } else if (text === '1. 请输入列表项') {\n            editor.selectionStart = cursorPos - 6;\n            editor.selectionEnd = cursorPos;\n        } else if (text === '> 请输入引用') {\n            editor.selectionStart = cursorPos - 5;\n            editor.selectionEnd = cursorPos;\n        } else {\n            editor.selectionStart = editor.selectionEnd = cursorPos;\n        }\n    // 找不到光标\n    } else {\n        editor.value += text;\n    }\n    editor.focus();\n    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n    preview.innerHTML = md.render(editor.value);\n};\n\n\n// 获取链接和图片地址\nvar getAddress = function(type) {\n    // 弹出表单\n    $formWrapper.css('display', 'block');\n    // 表单点击事件\n    $formWrapper.click(function(event) {\n        var $target = $(event.target);\n        // 取消按钮\n        if ($target.is('.cancel')) {\n            $('.form-wrapper input').val('');\n            $formWrapper.css('display', 'none');\n            $formWrapper.off('click keydown');\n            event.preventDefault();\n            editor.focus();\n            // 提交按钮\n        } else if ($target.is('.submit')) {\n            var word = $('.input-word').val().replace(regTrim, '');\n            var address = $('.input-address').val().replace(regTrim, '');\n            // 判断是插入图片还是链接\n            if (type === 'img') {\n                insertText('![' + word + ']' + '(' + address + ')');\n            } else {\n                insertText('[' + word + ']' + '(' + address + ')');\n            }\n            $('.form-wrapper input').val('');\n            $formWrapper.css('display', 'none');\n            $formWrapper.off('click keydown');\n            $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n            preview.innerHTML = md.render(editor.value);\n            event.preventDefault();\n            editor.focus();\n        }\n    });\n\n    // 回车提交事件\n    $formWrapper.keydown(function(event) {\n        var keyCode = event.keyCode || event.which;\n        // 如果按下回车键\n        if (keyCode === 13) {\n            var word = $('.input-word').val().replace(regTrim, '');\n            var address = $('.input-address').val().replace(regTrim, '');\n            if (type === 'img') {\n                insertText('![' + word + ']' + '(' + address + ')');\n            } else {\n                insertText('[' + word + ']' + '(' + address + ')');\n            }\n            $('.form-wrapper input').val('');\n            $formWrapper.css('display', 'none');\n            $formWrapper.off('click keydown');\n            preview.innerHTML = md.render(editor.value);\n            event.preventDefault();\n            editor.focus();\n        }\n    });\n};\n\n\n// 根据不同按钮向textarea插入文本\n$toolbar.click(function(event) {\n    var $target = $(event.target);\n    switch ($target.attr('class')) {\n        case 'add-heading':\n        case 'icon-heading':\n            insertText('## 请输入标题');\n            break;\n        case 'add-strong':\n        case 'icon-strong':\n            insertText('**请输入文字**');\n            break;\n        case 'add-italic':\n        case 'icon-italic':\n            insertText('*请输入文字*');\n            break;\n        case 'add-code':\n        case 'icon-code':\n            insertText('\\t 请输入代码');\n            break;\n        case 'add-link':\n        case 'icon-link':\n            getAddress('link');\n            break;\n        case 'add-img':\n        case 'icon-img':\n            getAddress('img');\n            break;\n        case 'add-ul':\n        case 'icon-ul':\n            insertText('* 请输入列表项');\n            break;\n        case 'add-ol':\n        case 'icon-ol':\n            insertText('1. 请输入列表项');\n            break;\n        case 'add-quote':\n        case 'icon-quote':\n            insertText('> 请输入引用');\n            break;\n        case 'add-line':\n        case 'icon-line':\n            insertText('----------');\n            break;\n    }\n});\n\n\n\n/*\n侧边栏\n*/\n\n// 初始化文章列表\n(function() {\n    for (var i = articleSource.length - 1; i >= 0; i--) {\n        var articleItem = articleSource[i];\n        // 长标题截短\n        var title = articleItem.title;\n        title = (title.length < 11) ? title : title.substring(0, 10) + '...';\n        $articleList.append('<li alt=\"' + articleItem.date + '\" title=\"选择文章\">' + title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n    }\n    $('.article-list li:first-child').addClass('active');\n})();\n\n\n// 显示文章列表\n$('#show-article').click(function() {\n    if ($('.aside').css('left') === '0px') {\n        $('.icon-arrow_left').removeClass('icon-arrow_left').addClass('icon-arrow_right');\n        $('.aside').css('left', '-250px');\n        $('#show-article').css('left', '0px');\n        $('.modal').css('display', 'none');\n        $('.wrapper').css('left', '0px');\n        // 重启自动保存\n        setLog();\n    } else {\n        $('.icon-arrow_right').removeClass('icon-arrow_right').addClass('icon-arrow_left');\n        $('.aside').css('left', '0px');\n        $('#show-article').css('left', '250px');\n        $('.modal').css('display', 'block');\n        $('.wrapper').css('left', '250px');\n        // 关闭自动保存\n        clearTimeout(timer);\n    }\n});\n\n\n// 删除和选择文章事件\n$articleList.click(function(event) {\n    var $target = $(event.target);\n    if ($target.is('.delete')) {\n        if (confirm('确定要删除此文章吗?')) {\n            // 获取父元素\n            var $targetLi = $target.parent('li');\n            // 如果删除的是当前编辑文章\n            if ($targetLi.is('.active')) {\n                // 切换到其他文章\n                if ($targetLi.next().is('li')) {\n                    $targetLi.next().click();\n                } else if ($targetLi.prev().is('li')) {\n                    $targetLi.prev().click();\n                } else {\n                    // 若无其他文章则新建\n                    $('.new-article').click();\n                }\n            }\n            // 根据日期查找文章\n            var date = $targetLi.attr('alt');\n            $targetLi.remove();\n            for (var i = 0; i < articleSource.length; i++) {\n                if (articleSource[i].date === date) {\n                    articleSource.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    } else if ($target.is('li') && !$target.is('.active')) {\n        // 清除记录栈\n        undoLog = [];\n        redoLog = [];\n        $undo.attr('disabled', true).css('background-color', '#555');\n        $redo.attr('disabled', true).css('background-color', '#555');\n        var date = $target.attr('alt');\n        $('.active').removeClass('active');\n        $target.addClass('active');\n        for (var i = 0; i < articleSource.length; i++) {\n            if (articleSource[i].date === date) {\n                // 将选择的文章放入列表底部\n                article = articleSource[i];\n                articleSource.push(articleSource[i]);\n                articleSource.splice(i, 1);\n                // 重新编辑设置日期\n                var now = new Date();\n                article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n                $target.attr('alt', article.date);\n                // 设置标题，编辑区和预览区\n                inputTitle.value = article.title;\n                editor.value = article.body;\n                preview.innerHTML = md.render(editor.value);\n                break;\n            }\n        }\n    }\n    saveArticle();\n});"]}