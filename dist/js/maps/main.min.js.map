{"version":3,"sources":["markeditor.js"],"names":["$","inputTitle","document","getElementById","editor","$editor","preview","$preview","marked","setOptions","highlight","code","hljs","highlightAuto","value","timer","$undo","$redo","undoLog","redoLog","$showDouble","$showEditor","$showPreview","$toolbar","$formWrapper","$articleList","regTrim","articleSpare","JSON","stringify","title","body","date","articleStorage","localStorage","getItem","articleSource","parse","article","length","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","innerHTML","saveArticle","setItem","style","height","clientHeight","window","addEventListener","on","attr","css","handleScroll","other","this","removeEventListener","percentage","scrollTop","scrollHeight","offsetHeight","setTimeout","setLog","shift","push","event","keyCode","which","start","selectionStart","end","selectionEnd","substring","preventDefault","stopPropagation","reader","FileReader","onload","evt","click","target","result","readAsText","dataTransfer","files","replace","match","find","html","$target","clearTimeout","removeClass","prepend","children","i","is","name","blob","Blob","type","saveAs","navigator","saveBlob","url","URL","createObjectURL","link","createElement","setAttribute","createEvent","initMouseEvent","dispatchEvent","pop","val","blur","redoTxt","display","width","insertText","text","selection","sel","createRange","startPos","endPos","cursorPos","tmpText","focus","getAddress","off","word","address","keydown","articleItem","append","addClass","confirm","$targetLi","parent","next","prev","remove","splice","jQuery"],"mappings":"CAAA,SAAAA,GAMA,GAAAC,GAAAC,SAAAC,eAAA,eAEAC,EAAAF,SAAAC,eAAA,UACAE,EAAAL,EAAAI,GAEAE,EAAAJ,SAAAC,eAAA,WACAI,EAAAP,EAAAM,EAEAE,QAAAC,YACAC,UAAA,SAAAC,GACA,MAAAC,MAAAC,cAAAF,GAAAG,QAIA,IAAAC,GAEAC,EAAAhB,EAAA,SACAiB,EAAAjB,EAAA,SAEAkB,KACAC,KAEAC,EAAApB,EAAA,gBACAqB,EAAArB,EAAA,gBACAsB,EAAAtB,EAAA,iBAEAuB,EAAAvB,EAAA,YAEAwB,EAAAxB,EAAA,iBAEAyB,EAAAzB,EAAA,iBAEA0B,EAAA,gBAIAC,cAAAC,KAAAC,YACAC,MAAA,MACAC,KAAA,QACAC,KAAA,uBAEAF,MAAA,MACAC,KAAA,QACAC,KAAA,uBAGA,IAAAC,GAAAC,aAAAC,QAAA,YAAAR,aACAS,EAAAR,KAAAS,MAAAJ,GAEAK,EAAAF,EAAAA,EAAAG,OAAA,GAEAC,EAAA,GAAAC,KACAH,GAAAN,KAAAQ,EAAAE,cAAA,KAAAF,EAAAG,WAAA,GAAA,IAAAH,EAAAI,UAAA,IAAAJ,EAAAK,WAAA,IAAAL,EAAAM,aAAA,IAAAN,EAAAO,aAEA9C,EAAAa,MAAAwB,EAAAR,MACA1B,EAAAU,MAAAwB,EAAAP,KACAzB,EAAA0C,UAAAxC,OAAAJ,EAAAU,MAIA,IAAAmC,GAAA,WACAhB,EAAAL,KAAAC,UAAAO,GACAF,aAAAgB,QAAA,UAAAjB,GAUA/B,UAAAC,eAAA,QAAAgD,MAAAC,OAAAlD,SAAA6B,KAAAsB,aAAA,GAAA,KACAC,OAAAC,iBAAA,SAAA,WACArD,SAAAC,eAAA,QAAAgD,MAAAC,OAAAlD,SAAA6B,KAAAsB,aAAA,GAAA,OAKAhD,EAAAmD,GAAA,uBAAA,WACAlD,EAAA0C,UAAAxC,OAAAJ,EAAAU,OAEAK,KACAF,EAAAwC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QACA1C,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,YAKA,IAAAC,GAAA,WACA,GAAAC,EAEAA,GADAC,OAAAzD,EACAE,EAEAF,EAGAwD,EAAAE,oBAAA,SAAAH,EAEA,IAAAI,GAAAF,KAAAG,WAAAH,KAAAI,aAAAJ,KAAAK,aACAN,GAAAI,UAAAD,GAAAH,EAAAK,aAAAL,EAAAM,cAEAC,WAAA,WACAP,EAAAL,iBAAA,SAAAI,IACA,KAEAvD,GAAAmD,iBAAA,SAAAI,GACArD,EAAAiD,iBAAA,SAAAI,EAIA,IAAAS,GAAA,WACAlD,EAAAA,EAAAqB,OAAA,KAAAnC,EAAAU,QAEAI,EAAAqB,OAAA,IACArB,EAAAmD,QAGAnD,EAAAoD,KAAAlE,EAAAU,OAEAwB,EAAAP,KAAA3B,EAAAU,MACAmC,KAEAlC,EAAAoD,WAAAC,EAAA,KAEAA,KAIAhE,EAAAmD,iBAAA,UAAA,SAAAgB,GACA,GAAAC,GAAAD,EAAAC,SAAAD,EAAAE,KAEA,IAAA,IAAAD,EAAA,CACA,GAAAE,GAAAtE,EAAAuE,eACAC,EAAAxE,EAAAyE,YACAzE,GAAAU,MAAAV,EAAAU,MAAAgE,UAAA,EAAAJ,GAAA,IAAAtE,EAAAU,MAAAgE,UAAAF,GACAxE,EAAAuE,eAAAvE,EAAAyE,aAAAH,EAAA,EAEAH,EAAAQ,iBACA/D,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACApD,EAAA0C,UAAAxC,OAAAJ,EAAAU,UAMAZ,SAAAqD,iBAAA,OAAA,SAAAgB,GACAA,EAAAQ,iBACAR,EAAAS,iBAEA,IAAAC,GAAA,GAAAC,WACAD,GAAAE,OAAA,SAAAC,GAEApF,EAAA,gBAAAqF,QACAjF,EAAAU,MAAAsE,EAAAE,OAAAC,OACAjD,EAAAP,KAAA3B,EAAAU,MACAR,EAAA0C,UAAAxC,OAAAJ,EAAAU,OACAmC,KAEAgC,EAAAO,WAAAjB,EAAAkB,aAAAC,MAAA,MACA,GASAzF,EAAAsD,iBAAA,SAAA,WAEAjB,EAAAR,MAAA7B,EAAAa,MAAA6E,QAAAjE,EAAA,IAAAiE,QAAA,UAAA,SAAAC,GACA,OAAAA,GACA,IAAA,IACA,MAAA,MACA,KAAA,IACA,MAAA,MACA,KAAA,IACA,MAAA,OACA,KAAA,IACA,MAAA,YAIAtD,EAAAR,MAAAQ,EAAAR,OAAAQ,EAAAN,IAEA,IAAAF,GAAAQ,EAAAR,KACAA,GAAAA,EAAAS,OAAA,GAAAT,EAAAA,EAAAgD,UAAA,EAAA,IAAA,MACArD,EAAAoE,KAAA,WAAAvD,EAAAN,KAAA,MAAA8D,KAAAhE,EAAA,uCACAmB,MAKAjD,EAAA,QAAAqF,MAAA,SAAAd,GACA,GAAAwB,GAAA/F,EAAAuE,EAAAe,OACA,QAAAS,EAAAtC,KAAA,UAEA,IAAA,cACA,IAAA,WAEAuC,aAAAjF,GAEAG,KACAC,KACAH,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QACAzC,EAAAwC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QACApB,GACAR,MAAA,OACAC,KAAA,GACAC,KAAA,IAEAI,EAAAkC,KAAAhC,EAEA,IAAAE,GAAA,GAAAC,KACAH,GAAAN,KAAAQ,EAAAE,cAAA,KAAAF,EAAAG,WAAA,GAAA,IAAAH,EAAAI,UAAA,IAAAJ,EAAAK,WAAA,IAAAL,EAAAM,aAAA,IAAAN,EAAAO,aAEA9C,EAAAa,MAAAwB,EAAAR,MACA1B,EAAAU,MAAAwB,EAAAP,KACAzB,EAAA0C,UAAAxC,OAAAJ,EAAAU,OAEAd,EAAA,WAAAiG,YAAA,UACAxE,EAAAyE,QAAA,2BAAA5D,EAAAN,KAAA,kBAAAM,EAAAR,MAAA,4CAEAsC,GACA,MAEA,KAAA,cACA,IAAA,WAGA,IAAA,GADA7B,IADAD,EAAAN,KACAP,EAAA0E,WAAA5D,QACA6D,EAAA,EAAA7D,EAAA6D,EAAAA,IACApG,EAAAyB,EAAA0E,WAAAC,IAAAC,GAAA,YACArG,EAAAyB,EAAA0E,WAAAC,IAAAP,KAAA,WAAAR,OAGA,MAEA,KAAA,eACA,IAAA,gBACA,GAAAiB,GAAAhE,EAAAR,MAAA,MACAyE,EAAA,GAAAC,OAAAlE,EAAAP,OACA0E,KAAA,cAEA,IAAAnD,OAAAoD,OAEApD,OAAAoD,OAAAH,EAAAD,OACA,IAAAK,UAAAC,SAEAD,UAAAC,SAAAL,EAAAD,OACA,CAEAO,IAAAC,IAAAC,gBAAAR,EACA,IAAAS,GAAA9G,SAAA+G,cAAA,IACAD,GAAAE,aAAA,OAAAL,KACAG,EAAAE,aAAA,WAAAZ,EAEA,IAAA/B,GAAArE,SAAAiH,YAAA,cACA5C,GAAA6C,eAAA,SAAA,GAAA,EAAA9D,OAAA,EAAA,EAAA,EAAA,EAAA,GAAA,GAAA,GAAA,GAAA,EAAA,EAAA,MACA0D,EAAAK,cAAA9C,GAEA,KAEA,KAAA,OACA,IAAA,YAEArD,EAAAqB,OAAA,IACApB,EAAAmD,KAAApD,EAAAoG,OACAjH,EAAAkH,IAAArG,EAAAA,EAAAqB,OAAA,IAAAiF,OACAvG,EAAAwC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACApD,EAAA0C,UAAAxC,OAAAJ,EAAAU,OACAwB,EAAAP,KAAA3B,EAAAU,MACAmC,IAEA/B,EAAAqB,QAAA,GACAvB,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QAGA,MAEA,KAAA,OACA,IAAA,YAEA,GAAA,IAAAvC,EAAAoB,OAAA,CACA,GAAAkF,GAAAtG,EAAAmG,KACApG,GAAAoD,KAAAmD,GACAzG,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACArD,EAAAkH,IAAAE,GAAAD,OACAlH,EAAA0C,UAAAxC,OAAAJ,EAAAU,OACAwB,EAAAP,KAAA3B,EAAAU,MACAmC,IAEA,IAAA9B,EAAAoB,QACAtB,EAAAwC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QAGA,KAEA,KAAA,cACA,IAAA,cACArD,EAAAqD,KACAgE,QAAA,QACAC,MAAA,QAEApH,EAAAmD,KACAgE,QAAA,QACAC,MAAA,QAEApG,EAAAmC,IAAA,UAAA,SACAtC,EAAAqC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QACArC,EAAAoC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACApC,EAAAmC,KAAA,YAAA,GAAAC,IAAA,mBAAA,UACA,MAEA,KAAA,cACA,IAAA,cACArD,EAAAqD,KACAgE,QAAA,QACAC,MAAA,SAEApH,EAAAmD,KACAgE,QAAA,OACAC,MAAA,OAEApG,EAAAmC,IAAA,UAAA,SACArC,EAAAoC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QACAtC,EAAAqC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACApC,EAAAmC,KAAA,YAAA,GAAAC,IAAA,mBAAA,UACA,MAEA,KAAA,eACA,IAAA,eACArD,EAAAqD,KACAgE,QAAA,OACAC,MAAA,OAEApH,EAAAmD,KACAgE,QAAA,QACAC,MAAA,SAEApG,EAAAmC,IAAA,UAAA,QACApC,EAAAmC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QACArC,EAAAoC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACAtC,EAAAqC,KAAA,YAAA,GAAAC,IAAA,mBAAA,UACA,MAEA,KAAA,YACA,IAAA,YACA,SAAA1D,EAAA,SAAA0D,IAAA,WACA1D,EAAA,SAAA0D,IAAA,UAAA,SAEA1D,EAAA,SAAA0D,IAAA,UAAA,UAaA,IAAAkE,GAAA,SAAAC,GAEA,GAAA3H,SAAA4H,UAAA,CACA,GAAAC,GAAA7H,SAAA4H,UAAAE,aACAD,GAAAF,KAAAA,MAEA,IAAA,gBAAAzH,GAAAuE,gBAAA,gBAAAvE,GAAAyE,aAAA,CAEA,GAAAoD,GAAA7H,EAAAuE,eACAuD,EAAA9H,EAAAyE,aACAsD,EAAAF,EAEAG,EAAAhI,EAAAU,KACAV,GAAAU,MAAAsH,EAAAtD,UAAA,EAAAmD,GAAAJ,EAAAO,EAAAtD,UAAAoD,EAAAE,EAAA7F,QAEA4F,GAAAN,EAAAtF,OAEA,aAAAsF,GACAzH,EAAAuE,eAAAwD,EAAA,EACA/H,EAAAyE,aAAAsD,GACA,cAAAN,GACAzH,EAAAuE,eAAAwD,EAAA,EACA/H,EAAAyE,aAAAsD,EAAA,GACA,YAAAN,GACAzH,EAAAuE,eAAAwD,EAAA,EACA/H,EAAAyE,aAAAsD,EAAA,GACA,YAAAN,GACAzH,EAAAuE,eAAAwD,EAAA,EACA/H,EAAAyE,aAAAsD,GACA,aAAAN,GACAzH,EAAAuE,eAAAwD,EAAA,EACA/H,EAAAyE,aAAAsD,GACA,cAAAN,GACAzH,EAAAuE,eAAAwD,EAAA,EACA/H,EAAAyE,aAAAsD,GACA,YAAAN,GACAzH,EAAAuE,eAAAwD,EAAA,EACA/H,EAAAyE,aAAAsD,GAEA/H,EAAAuE,eAAAvE,EAAAyE,aAAAsD,MAIA/H,GAAAU,OAAA+G,CAEAzH,GAAAiI,QACArH,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACApD,EAAA0C,UAAAxC,OAAAJ,EAAAU,QAKAwH,EAAA,SAAA7B,GAEAjF,EAAAkC,IAAA,UAAA,SAEAlC,EAAA6D,MAAA,SAAAd,GACA,GAAAwB,GAAA/F,EAAAuE,EAAAe,OAEA,IAAAS,EAAAM,GAAA,WACArG,EAAA,uBAAAuH,IAAA,IACA/F,EAAAkC,IAAA,UAAA,QACAlC,EAAA+G,IAAA,iBACAhE,EAAAQ,iBACA3E,EAAAiI,YAEA,IAAAtC,EAAAM,GAAA,WAAA,CACA,GAAAmC,GAAAxI,EAAA,eAAAuH,MAAA5B,QAAAjE,EAAA,IACA+G,EAAAzI,EAAA,kBAAAuH,MAAA5B,QAAAjE,EAAA,GAGAkG,GADA,QAAAnB,EACA,KAAA+B,EAAA,KAAAC,EAAA,IAEA,IAAAD,EAAA,KAAAC,EAAA,KAEAzI,EAAA,uBAAAuH,IAAA,IACA/F,EAAAkC,IAAA,UAAA,QACAlC,EAAA+G,IAAA,iBACAvH,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,WACApD,EAAA0C,UAAAxC,OAAAJ,EAAAU,OACAyD,EAAAQ,iBACA3E,EAAAiI,WAKA7G,EAAAkH,QAAA,SAAAnE,GACA,GAAAC,GAAAD,EAAAC,SAAAD,EAAAE,KAEA,IAAA,KAAAD,EAAA,CACA,GAAAgE,GAAAxI,EAAA,eAAAuH,MAAA5B,QAAAjE,EAAA,IACA+G,EAAAzI,EAAA,kBAAAuH,MAAA5B,QAAAjE,EAAA,GAEAkG,GADA,QAAAnB,EACA,KAAA+B,EAAA,KAAAC,EAAA,IAEA,IAAAD,EAAA,KAAAC,EAAA,KAEAzI,EAAA,uBAAAuH,IAAA,IACA/F,EAAAkC,IAAA,UAAA,QACAlC,EAAA+G,IAAA,iBACAjI,EAAA0C,UAAAxC,OAAAJ,EAAAU,OACAyD,EAAAQ,iBACA3E,EAAAiI,WAOA9G,GAAA8D,MAAA,SAAAd,GACA,GAAAwB,GAAA/F,EAAAuE,EAAAe,OACA,QAAAS,EAAAtC,KAAA,UACA,IAAA,cACA,IAAA,eACAmE,EAAA,WACA,MACA,KAAA,aACA,IAAA,cACAA,EAAA,YACA,MACA,KAAA,aACA,IAAA,cACAA,EAAA,UACA,MACA,KAAA,WACA,IAAA,YACAA,EAAA,UACA,MACA,KAAA,WACA,IAAA,YACAU,EAAA,OACA,MACA,KAAA,UACA,IAAA,WACAA,EAAA,MACA,MACA,KAAA,SACA,IAAA,UACAV,EAAA,WACA,MACA,KAAA,SACA,IAAA,UACAA,EAAA,YACA,MACA,KAAA,YACA,IAAA,aACAA,EAAA,UACA,MACA,KAAA,WACA,IAAA,YACAA,EAAA,iBAYA,WACA,IAAA,GAAAxB,GAAAhE,EAAAG,OAAA,EAAA6D,GAAA,EAAAA,IAAA,CACA,GAAAuC,GAAAvG,EAAAgE,GAEAtE,EAAA6G,EAAA7G,KACAA,GAAAA,EAAAS,OAAA,GAAAT,EAAAA,EAAAgD,UAAA,EAAA,IAAA,MACArD,EAAAmH,OAAA,YAAAD,EAAA3G,KAAA,kBAAAF,EAAA,4CAEA9B,EAAA,gCAAA6I,SAAA,aAKA7I,EAAA,iBAAAqF,MAAA,WACA,QAAArF,EAAA,UAAA0D,IAAA,SACA1D,EAAA,oBAAAiG,YAAA,mBAAA4C,SAAA,oBACA7I,EAAA,UAAA0D,IAAA,OAAA,UACA1D,EAAA,iBAAA0D,IAAA,OAAA,OACA1D,EAAA,UAAA0D,IAAA,UAAA,QACA1D,EAAA,YAAA0D,IAAA,OAAA,OAEAU,MAEApE,EAAA,qBAAAiG,YAAA,oBAAA4C,SAAA,mBACA7I,EAAA,UAAA0D,IAAA,OAAA,OACA1D,EAAA,iBAAA0D,IAAA,OAAA,SACA1D,EAAA,UAAA0D,IAAA,UAAA,SACA1D,EAAA,YAAA0D,IAAA,OAAA,SAEAsC,aAAAjF,MAMAU,EAAA4D,MAAA,SAAAd,GACA,GAAAwB,GAAA/F,EAAAuE,EAAAe,OACA,IAAAS,EAAAM,GAAA,YACA,GAAAyC,QAAA,cAAA,CAEA,GAAAC,GAAAhD,EAAAiD,OAAA,KAEAD,GAAA1C,GAAA,aAEA0C,EAAAE,OAAA5C,GAAA,MACA0C,EAAAE,OAAA5D,QACA0D,EAAAG,OAAA7C,GAAA,MACA0C,EAAAG,OAAA7D,QAGArF,EAAA,gBAAAqF,QAIA,IAAArD,GAAA+G,EAAAtF,KAAA,MACAsF,GAAAI,QACA,KAAA,GAAA/C,GAAA,EAAAA,EAAAhE,EAAAG,OAAA6D,IACA,GAAAhE,EAAAgE,GAAApE,OAAAA,EAAA,CACAI,EAAAgH,OAAAhD,EAAA,EACA,aAIA,IAAAL,EAAAM,GAAA,QAAAN,EAAAM,GAAA,WAAA,CAEAnF,KACAC,KACAH,EAAAyC,KAAA,YAAA,GAAAC,IAAA,mBAAA,QACAzC,EAAAwC,KAAA,YAAA,GAAAC,IAAA,mBAAA,OACA,IAAA1B,GAAA+D,EAAAtC,KAAA,MACAzD,GAAA,WAAAiG,YAAA,UACAF,EAAA8C,SAAA,SACA,KAAA,GAAAzC,GAAA,EAAAA,EAAAhE,EAAAG,OAAA6D,IACA,GAAAhE,EAAAgE,GAAApE,OAAAA,EAAA,CAEAM,EAAAF,EAAAgE,GACAhE,EAAAkC,KAAAlC,EAAAgE,IACAhE,EAAAgH,OAAAhD,EAAA,EAEA,IAAA5D,GAAA,GAAAC,KACAH,GAAAN,KAAAQ,EAAAE,cAAA,KAAAF,EAAAG,WAAA,GAAA,IAAAH,EAAAI,UAAA,IAAAJ,EAAAK,WAAA,IAAAL,EAAAM,aAAA,IAAAN,EAAAO,aACAgD,EAAAtC,KAAA,MAAAnB,EAAAN,MAEA/B,EAAAa,MAAAwB,EAAAR,MACA1B,EAAAU,MAAAwB,EAAAP,KACAzB,EAAA0C,UAAAxC,OAAAJ,EAAAU,MACA,QAIAmC,OAEAoG","file":"../main.min.js","sourcesContent":["(function($) {\n    /*\n    一些初始化\n    */\n\n    // 标题输入区\n    var inputTitle = document.getElementById('input-title');\n    // 编辑区\n    var editor = document.getElementById('editor');\n    var $editor = $(editor);\n    // 预览区\n    var preview = document.getElementById('preview');\n    var $preview = $(preview);\n    // 配置markdown编译器和highlight.js\n    marked.setOptions({\n        highlight: function(code) {\n            return hljs.highlightAuto(code).value;\n        }\n    });\n    // 自动保存定时器\n    var timer;\n    // undo redo按钮\n    var $undo = $('.undo');\n    var $redo = $('.redo');\n    // undo redo 记录栈\n    var undoLog = [];\n    var redoLog = [];\n    // 区域显示按钮\n    var $showDouble = $('.show-double');\n    var $showEditor = $('.show-editor');\n    var $showPreview = $('.show-preview');\n    // 浮动工具栏\n    var $toolbar = $('.toolbar');\n    // 弹出层\n    var $formWrapper = $('.form-wrapper');\n    // 文章列表\n    var $articleList = $('.article-list');\n    // 去除前后空格\n    var regTrim = /(^\\s*)|(\\s*$)/g;\n\n\n    // 备用文章\n    articleSpare = JSON.stringify([{\n        title: '文章1',\n        body: '# 文章1',\n        date: '2016-5-20 20:41:48'\n    }, {\n        title: '文章2',\n        body: '# 文章2',\n        date: '2016-5-20 20:41:49'\n    }]);\n    // 获取本地存储文章\n    var articleStorage = localStorage.getItem('article') || articleSpare;\n    var articleSource = JSON.parse(articleStorage);\n    // 选择最近一次编辑的文章作为当前文章\n    var article = articleSource[articleSource.length - 1];\n    // 重新编辑设置日期\n    var now = new Date();\n    article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n    // 设置标题，编辑区和预览区\n    inputTitle.value = article.title;\n    editor.value = article.body;\n    preview.innerHTML = marked(editor.value);\n\n\n    // 将文章保存到本地\n    var saveArticle = function() {\n        articleStorage = JSON.stringify(articleSource);\n        localStorage.setItem('article', articleStorage);\n    };\n\n\n\n    /*\n    编辑区和预览区\n    */\n\n    // 动态设置主区域高度\n    document.getElementById('main').style.height = (document.body.clientHeight - 60) + 'px';\n    window.addEventListener('resize', function() {\n        document.getElementById('main').style.height = (document.body.clientHeight - 60) + 'px';\n    });\n\n\n    // 实时预览\n    $editor.on('input propertychange', function() {\n        preview.innerHTML = marked(editor.value);\n        // redo不可用 undo可用\n        redoLog = [];\n        $redo.attr('disabled', true).css('background-color', '#555');\n        $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n    });\n\n\n    // 编辑区和预览区设置同步滚动\n    var handleScroll = function() {\n        var other;\n        if (this === editor) {\n            other = preview;\n        } else {\n            other = editor;\n        }\n        // 移除另一个区域的滚动事件 防止循环滚动\n        other.removeEventListener('scroll', handleScroll);\n        // 滚动大小按内容百分比计算\n        var percentage = this.scrollTop / (this.scrollHeight - this.offsetHeight);\n        other.scrollTop = percentage * (other.scrollHeight - other.offsetHeight);\n        // 恢复另一个区域的滚动事件\n        setTimeout(function() {\n            other.addEventListener('scroll', handleScroll);\n        }, 200);\n    }\n    editor.addEventListener('scroll', handleScroll);\n    preview.addEventListener('scroll', handleScroll);\n\n\n    // 定时记录编辑区并自动保存\n    var setLog = function() {\n        if (undoLog[undoLog.length - 1] !== editor.value) {\n            // 防止存储记录过多\n            if (undoLog.length > 50) {\n                undoLog.shift();\n            }\n            // 记录数据\n            undoLog.push(editor.value);\n            // 自动保存\n            article.body = editor.value;\n            saveArticle();\n        }\n        timer = setTimeout(setLog, 800);\n    };\n    setLog();\n\n\n    // 阻止tab键切换文本框\n    editor.addEventListener('keydown', function(event) {\n        var keyCode = event.keyCode || event.which;\n        // 如果按下tab键\n        if (keyCode === 9) {\n            var start = editor.selectionStart,\n                end = editor.selectionEnd;\n            editor.value = editor.value.substring(0, start) + '\\t' + editor.value.substring(end);\n            editor.selectionStart = editor.selectionEnd = start + 1;\n            // 阻止默认事件\n            event.preventDefault();\n            $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n            preview.innerHTML = marked(editor.value);\n        }\n    });\n\n\n    // 文件拖拽上传\n    document.addEventListener('drop', function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        // 文件读取API\n        var reader = new FileReader();\n        reader.onload = function(evt) {\n            // 创建新文章并初始化\n            $('.new-article').click();\n            editor.value = evt.target.result;\n            article.body = editor.value;\n            preview.innerHTML = marked(editor.value);\n            saveArticle();\n        };\n        reader.readAsText(event.dataTransfer.files[0]);\n    }, false);\n\n\n\n    /*\n    导航栏\n    */\n\n    // 记录标题变动\n    inputTitle.addEventListener('change', function() {\n        // 去除前后空格并做XSS输入过滤\n        article.title = inputTitle.value.replace(regTrim, '').replace(/[<>'&]/g, function(match) {\n            switch (match) {\n                case '<':\n                    return '&lt;';\n                case '>':\n                    return '&gt;';\n                case '&':\n                    return '&amp;';\n                case '\\'':\n                    return '&quot;';\n            }\n        });\n        // 若输入为空则取日期为标题\n        article.title = article.title || article.date;\n        // 长标题截短\n        var title = article.title;\n        title = (title.length < 11) ? title : title.substring(0, 10) + '...';\n        $articleList.find('li[alt=\"' + article.date + '\"]').html(title + '<a class=\"delete\" title=\"删除文章\"></a>');\n        saveArticle();\n    });\n\n\n    // 导航栏按钮点击事件\n    $('.nav').click(function(event) {\n        var $target = $(event.target);\n        switch ($target.attr('class')) {\n            // 新建文章\n            case 'new-article':\n            case 'icon-new':\n                // 关闭自动保存\n                clearTimeout(timer);\n                // 清除记录栈\n                undoLog = [];\n                redoLog = [];\n                $undo.attr('disabled', true).css('background-color', '#555');\n                $redo.attr('disabled', true).css('background-color', '#555');\n                article = {\n                    title: '新建文章',\n                    body: '',\n                    date: ''\n                };\n                articleSource.push(article);\n                // 设置日期\n                var now = new Date();\n                article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n                // 设置标题，编辑区和预览区\n                inputTitle.value = article.title;\n                editor.value = article.body;\n                preview.innerHTML = marked(editor.value);\n                // 添加到文章列表\n                $('.active').removeClass('active');\n                $articleList.prepend('<li class=\"active\" alt=\"' + article.date + '\" title=\"选择文章\">' + article.title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n                // 重启自动保存\n                setLog();\n                break;\n                //删除文章\n            case 'del-article':\n            case 'icon-del':\n                var date = article.date;\n                var length = $articleList.children().length;\n                for (var i = 0; i < length; i++) {\n                    if ($($articleList.children()[i]).is('.active')) {\n                        $($articleList.children()[i]).find('.delete').click();\n                    }\n                }\n                break;\n                // 导出文章\n            case 'down-article':\n            case 'icon-download':\n                var name = article.title + '.md';\n                var blob = new Blob([article.body], {\n                    type: 'text/plain'\n                });\n                if (window.saveAs) {\n                    // IE\n                    window.saveAs(blob, name);\n                } else if (navigator.saveBlob) {\n                    // IE\n                    navigator.saveBlob(blob, name);\n                } else {\n                    // 非IE\n                    url = URL.createObjectURL(blob);\n                    var link = document.createElement(\"a\");\n                    link.setAttribute('href', url);\n                    link.setAttribute('download', name);\n                    // 模拟点击下载事件\n                    var event = document.createEvent('MouseEvents');\n                    event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                    link.dispatchEvent(event);\n                }\n                break;\n                // 撤销\n            case 'undo':\n            case 'icon-undo':\n                // 如果存在初始值以外内容，执行操作\n                if (undoLog.length > 1) {\n                    redoLog.push(undoLog.pop());\n                    $editor.val(undoLog[undoLog.length - 1]).blur();\n                    $redo.attr('disabled', false).css('background-color', '#fcfcfc');\n                    preview.innerHTML = marked(editor.value);\n                    article.body = editor.value;\n                    saveArticle();\n                    // 当撤销记录栈没有初始值以外内容时，设置按钮不可用\n                    if (undoLog.length <= 1) {\n                        $undo.attr('disabled', true).css('background-color', '#555');\n                    }\n                }\n                break;\n                // 恢复\n            case 'redo':\n            case 'icon-redo':\n                // 如果存在内容，执行操作\n                if (redoLog.length !== 0) {\n                    var redoTxt = redoLog.pop();\n                    undoLog.push(redoTxt);\n                    $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n                    $editor.val(redoTxt).blur();\n                    preview.innerHTML = marked(editor.value);\n                    article.body = editor.value;\n                    saveArticle();\n                    // 当恢复记录栈没有内容时，设置按钮不可用\n                    if (redoLog.length === 0) {\n                        $redo.attr('disabled', true).css('background-color', '#555');\n                    }\n                }\n                break;\n                // 双屏显示\n            case 'show-double':\n            case 'icon-double':\n                $editor.css({\n                    'display': 'block',\n                    'width': '48%'\n                });\n                $preview.css({\n                    'display': 'block',\n                    'width': '52%'\n                });\n                $toolbar.css('display', 'block');\n                $showDouble.attr('disabled', true).css('background-color', '#555');\n                $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n                $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n                break;\n                // 只显示编辑区\n            case 'show-editor':\n            case 'icon-editor':\n                $editor.css({\n                    'display': 'block',\n                    'width': '100%'\n                });\n                $preview.css({\n                    'display': 'none',\n                    'width': '0%'\n                });\n                $toolbar.css('display', 'block');\n                $showEditor.attr('disabled', true).css('background-color', '#555');\n                $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n                $showPreview.attr('disabled', false).css('background-color', '#fcfcfc');\n                break;\n                // 只显示预览区\n            case 'show-preview':\n            case 'icon-preview':\n                $editor.css({\n                    'display': 'none',\n                    'width': '0%'\n                });\n                $preview.css({\n                    'display': 'block',\n                    'width': '100%'\n                });\n                $toolbar.css('display', 'none');\n                $showPreview.attr('disabled', true).css('background-color', '#555');\n                $showEditor.attr('disabled', false).css('background-color', '#fcfcfc');\n                $showDouble.attr('disabled', false).css('background-color', '#fcfcfc');\n                break;\n                // 显示语法帮助\n            case 'show-tips':\n            case 'icon-tips':\n                if ($('.tips').css('display') === 'none') {\n                    $('.tips').css('display', 'block');\n                } else {\n                    $('.tips').css('display', 'none');\n                }\n                break;\n        }\n    });\n\n\n\n    /*\n    浮动工具栏\n    */\n\n    // 在光标处插入文本\n    var insertText = function(text) {\n        // IE\n        if (document.selection) {\n            var sel = document.selection.createRange();\n            sel.text = text;\n            // 非IE\n        } else if (typeof editor.selectionStart === 'number' && typeof editor.selectionEnd === 'number') {\n            // 获取文本起始点和结束点\n            var startPos = editor.selectionStart;\n            var endPos = editor.selectionEnd;\n            var cursorPos = startPos;\n            // 插入文本\n            var tmpText = editor.value;\n            editor.value = tmpText.substring(0, startPos) + text + tmpText.substring(endPos, tmpText.length);\n            // 移动光标\n            cursorPos += text.length;\n            // 改变选中区域\n            if (text === '## 请输入标题') {\n                editor.selectionStart = cursorPos - 5;\n                editor.selectionEnd = cursorPos;\n            } else if (text === '**请输入文字**') {\n                editor.selectionStart = cursorPos - 7;\n                editor.selectionEnd = cursorPos - 2;\n            } else if (text === '*请输入文字*') {\n                editor.selectionStart = cursorPos - 6;\n                editor.selectionEnd = cursorPos - 1;\n            } else if (text === '\\t 请输入代码') {\n                editor.selectionStart = cursorPos - 5;\n                editor.selectionEnd = cursorPos;\n            } else if (text === '* 请输入列表项') {\n                editor.selectionStart = cursorPos - 6;\n                editor.selectionEnd = cursorPos;\n            } else if (text === '1. 请输入列表项') {\n                editor.selectionStart = cursorPos - 6;\n                editor.selectionEnd = cursorPos;\n            } else if (text === '> 请输入引用') {\n                editor.selectionStart = cursorPos - 5;\n                editor.selectionEnd = cursorPos;\n            } else {\n                editor.selectionStart = editor.selectionEnd = cursorPos;\n            }\n            // 找不到光标\n        } else {\n            editor.value += text;\n        }\n        editor.focus();\n        $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n        preview.innerHTML = marked(editor.value);\n    };\n\n\n    // 获取链接和图片地址\n    var getAddress = function(type) {\n        // 弹出表单\n        $formWrapper.css('display', 'block');\n        // 表单点击事件\n        $formWrapper.click(function(event) {\n            var $target = $(event.target);\n            // 取消按钮\n            if ($target.is('.cancel')) {\n                $('.form-wrapper input').val('');\n                $formWrapper.css('display', 'none');\n                $formWrapper.off('click keydown');\n                event.preventDefault();\n                editor.focus();\n                // 提交按钮\n            } else if ($target.is('.submit')) {\n                var word = $('.input-word').val().replace(regTrim, '');\n                var address = $('.input-address').val().replace(regTrim, '');\n                // 判断是插入图片还是链接\n                if (type === 'img') {\n                    insertText('![' + word + ']' + '(' + address + ')');\n                } else {\n                    insertText('[' + word + ']' + '(' + address + ')');\n                }\n                $('.form-wrapper input').val('');\n                $formWrapper.css('display', 'none');\n                $formWrapper.off('click keydown');\n                $undo.attr('disabled', false).css('background-color', '#fcfcfc');\n                preview.innerHTML = marked(editor.value);\n                event.preventDefault();\n                editor.focus();\n            }\n        });\n\n        // 回车提交事件\n        $formWrapper.keydown(function(event) {\n            var keyCode = event.keyCode || event.which;\n            // 如果按下回车键\n            if (keyCode === 13) {\n                var word = $('.input-word').val().replace(regTrim, '');\n                var address = $('.input-address').val().replace(regTrim, '');\n                if (type === 'img') {\n                    insertText('![' + word + ']' + '(' + address + ')');\n                } else {\n                    insertText('[' + word + ']' + '(' + address + ')');\n                }\n                $('.form-wrapper input').val('');\n                $formWrapper.css('display', 'none');\n                $formWrapper.off('click keydown');\n                preview.innerHTML = marked(editor.value);\n                event.preventDefault();\n                editor.focus();\n            }\n        });\n    };\n\n\n    // 根据不同按钮向textarea插入文本\n    $toolbar.click(function(event) {\n        var $target = $(event.target);\n        switch ($target.attr('class')) {\n            case 'add-heading':\n            case 'icon-heading':\n                insertText('## 请输入标题');\n                break;\n            case 'add-strong':\n            case 'icon-strong':\n                insertText('**请输入文字**');\n                break;\n            case 'add-italic':\n            case 'icon-italic':\n                insertText('*请输入文字*');\n                break;\n            case 'add-code':\n            case 'icon-code':\n                insertText('\\t 请输入代码');\n                break;\n            case 'add-link':\n            case 'icon-link':\n                getAddress('link');\n                break;\n            case 'add-img':\n            case 'icon-img':\n                getAddress('img');\n                break;\n            case 'add-ul':\n            case 'icon-ul':\n                insertText('* 请输入列表项');\n                break;\n            case 'add-ol':\n            case 'icon-ol':\n                insertText('1. 请输入列表项');\n                break;\n            case 'add-quote':\n            case 'icon-quote':\n                insertText('> 请输入引用');\n                break;\n            case 'add-line':\n            case 'icon-line':\n                insertText('----------');\n                break;\n        }\n    });\n\n\n\n    /*\n    侧边栏\n    */\n\n    // 初始化文章列表\n    (function() {\n        for (var i = articleSource.length - 1; i >= 0; i--) {\n            var articleItem = articleSource[i];\n            // 长标题截短\n            var title = articleItem.title;\n            title = (title.length < 11) ? title : title.substring(0, 10) + '...';\n            $articleList.append('<li alt=\"' + articleItem.date + '\" title=\"选择文章\">' + title + '<a class=\"delete\" title=\"删除文章\"></a></li>');\n        }\n        $('.article-list li:first-child').addClass('active');\n    })();\n\n\n    // 显示文章列表\n    $('#show-article').click(function() {\n        if ($('.aside').css('left') === '0px') {\n            $('.icon-arrow_left').removeClass('icon-arrow_left').addClass('icon-arrow_right');\n            $('.aside').css('left', '-250px');\n            $('#show-article').css('left', '0px');\n            $('.modal').css('display', 'none');\n            $('.wrapper').css('left', '0px');\n            // 重启自动保存\n            setLog();\n        } else {\n            $('.icon-arrow_right').removeClass('icon-arrow_right').addClass('icon-arrow_left');\n            $('.aside').css('left', '0px');\n            $('#show-article').css('left', '250px');\n            $('.modal').css('display', 'block');\n            $('.wrapper').css('left', '250px');\n            // 关闭自动保存\n            clearTimeout(timer);\n        }\n    });\n\n\n    // 删除和选择文章事件\n    $articleList.click(function(event) {\n        var $target = $(event.target);\n        if ($target.is('.delete')) {\n            if (confirm('确定要删除此文章吗?')) {\n                // 获取父元素\n                var $targetLi = $target.parent('li');\n                // 如果删除的是当前编辑文章\n                if ($targetLi.is('.active')) {\n                    // 切换到其他文章\n                    if ($targetLi.next().is('li')) {\n                        $targetLi.next().click();\n                    } else if ($targetLi.prev().is('li')) {\n                        $targetLi.prev().click();\n                    } else {\n                        // 若无其他文章则新建\n                        $('.new-article').click();\n                    }\n                }\n                // 根据日期查找文章\n                var date = $targetLi.attr('alt');\n                $targetLi.remove();\n                for (var i = 0; i < articleSource.length; i++) {\n                    if (articleSource[i].date === date) {\n                        articleSource.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n        } else if ($target.is('li') && !$target.is('.active')) {\n            // 清除记录栈\n            undoLog = [];\n            redoLog = [];\n            $undo.attr('disabled', true).css('background-color', '#555');\n            $redo.attr('disabled', true).css('background-color', '#555');\n            var date = $target.attr('alt');\n            $('.active').removeClass('active');\n            $target.addClass('active');\n            for (var i = 0; i < articleSource.length; i++) {\n                if (articleSource[i].date === date) {\n                    // 将选择的文章放入列表底部\n                    article = articleSource[i];\n                    articleSource.push(articleSource[i]);\n                    articleSource.splice(i, 1);\n                    // 重新编辑设置日期\n                    var now = new Date();\n                    article.date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n                    $target.attr('alt', article.date);\n                    // 设置标题，编辑区和预览区\n                    inputTitle.value = article.title;\n                    editor.value = article.body;\n                    preview.innerHTML = marked(editor.value);\n                    break;\n                }\n            }\n        }\n        saveArticle();\n    });\n})(jQuery);"]}