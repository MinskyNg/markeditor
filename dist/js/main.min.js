function setLog(){undoLog[undoLog.length-1]!==editor.value&&(undoLog.length>50&&undoLog.shift(),undoLog[undoLog.length]=editor.value,article.body=editor.value,articleStorage=JSON.stringify(articleSource),localStorage.setItem("article",articleStorage)),timer=setTimeout(setLog,800)}var inputTitle=document.getElementById("input-title"),editor=document.getElementById("editor"),$editor=$(editor),preview=document.getElementById("preview"),$preview=$(preview),md=markdownit({highlight:function(e,t){if(t&&hljs.getLanguage(t))try{return hljs.highlight(t,e).value}catch(r){}return""}}),timer,$undo=$(".undo"),$redo=$(".redo"),undoLog=[],redoLog=[],$showDouble=$(".show-double"),$showEditor=$(".show-editor"),$showPreview=$(".show-preview"),$articleList=$(".article-list");articleSpare=JSON.stringify([{title:"文章1",body:"# 文章1",date:"2016-5-20 20:41:48"},{title:"文章2",body:"# 文章2",date:"2016-5-20 20:41:49"}]);var articleStorage=localStorage.getItem("article")||articleSpare,articleSource=JSON.parse(articleStorage),article=articleSource[articleSource.length-1],now=new Date;article.date=now.getFullYear()+"-"+(now.getMonth()+1)+"-"+now.getDate()+" "+now.getHours()+":"+now.getMinutes()+":"+now.getSeconds(),inputTitle.value=article.title,editor.value=article.body,preview.innerHTML=md.render(editor.value),$("#main").height(document.body.clientHeight-60),$(window).resize(function(){$("#main").height(document.body.clientHeight-60)}),$editor.on("input propertychange",function(){preview.innerHTML=md.render(editor.value),redoLog=[],$redo.attr("disabled",!0).css("background-color","#555"),$undo.attr("disabled",!1).css("background-color","#fcfcfc")});var $divs=$("#editor, #preview"),handleScroll=function(){var e=$divs.not(this).off("scroll"),t=e.get(0),r=this.scrollTop/(this.scrollHeight-this.offsetHeight);t.scrollTop=r*(t.scrollHeight-t.offsetHeight),setTimeout(function(){e.on("scroll",handleScroll)},300)};$divs.on("scroll",handleScroll),inputTitle.addEventListener("change",function(){article.title=inputTitle.value||article.date,article.title=article.title.replace(/[<>'&]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&quot;"}}),$articleList.find('li[alt="'+article.date+'"]').text(article.title),articleStorage=JSON.stringify(articleSource),localStorage.setItem("article",articleStorage)}),setLog(),$(".new-article").click(function(){clearTimeout(timer),undoLog=[],redoLog=[],$undo.attr("disabled",!0).css("background-color","#555"),$redo.attr("disabled",!0).css("background-color","#555"),article={title:"新建文章",body:"",date:""},articleSource.push(article);var e=new Date;article.date=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),inputTitle.value=article.title,editor.value=article.body,preview.innerHTML=md.render(editor.value),$(".active").removeClass("active"),$articleList.prepend('<li class="active" alt="'+article.date+'" title="选择文章">'+article.title+'<a class="delete" title="删除文章"></a></li>'),setLog()}),$(".del-article").click(function(){for(var e=(article.date,$articleList.children().length),t=0;e>t;t++)$($articleList.children()[t]).is(".active")&&$($articleList.children()[t]).find(".delete").click()}),$undo.click(function(){redoLog.push(undoLog.pop()),$editor.val(undoLog[undoLog.length-1]).blur(),undoLog[undoLog.length-1]||$undo.attr("disabled",!0).css("background-color","#555"),$redo.attr("disabled",!1).css("background-color","#fcfcfc"),preview.innerHTML=md.render(editor.value),article.body=editor.value,articleStorage=JSON.stringify(articleSource),localStorage.setItem("article",articleStorage)}),$redo.click(function(){var e=redoLog.pop();undoLog.push(e),redoLog[redoLog.length-1]||$redo.attr("disabled",!0).css("background-color","#555"),$undo.attr("disabled",!1).css("background-color","#fcfcfc"),$editor.val(e).blur(),preview.innerHTML=md.render(editor.value),article.body=editor.value,articleStorage=JSON.stringify(articleSource),localStorage.setItem("article",articleStorage)}),$showDouble.click(function(){$editor.css({display:"block",width:"48%"}),$preview.css({display:"block",width:"52%"}),$showDouble.attr("disabled",!0).css("background-color","#555"),$showEditor.attr("disabled",!1).css("background-color","#fcfcfc"),$showPreview.attr("disabled",!1).css("background-color","#fcfcfc")}),$showEditor.click(function(){$editor.css({display:"block",width:"100%"}),$preview.css({display:"none",width:"0%"}),$showEditor.attr("disabled",!0).css("background-color","#555"),$showDouble.attr("disabled",!1).css("background-color","#fcfcfc"),$showPreview.attr("disabled",!1).css("background-color","#fcfcfc")}),$showPreview.click(function(){$editor.css({display:"none",width:"0%"}),$preview.css({display:"block",width:"100%"}),$showPreview.attr("disabled",!0).css("background-color","#555"),$showEditor.attr("disabled",!1).css("background-color","#fcfcfc"),$showDouble.attr("disabled",!1).css("background-color","#fcfcfc")}),$(".show-tips").click(function(){"none"===$(".tips").css("display")?$(".tips").css("display","block"):$(".tips").css("display","none")}),function(){for(var e=articleSource.length-1;e>=0;e--){var t=articleSource[e];$articleList.append('<li alt="'+t.date+'" title="选择文章">'+t.title+'<a class="delete" title="删除文章"></a></li>')}$(".article-list li:first-child").addClass("active")}(),$("#show-article").click(function(){"0px"===$(".aside").css("left")?($("#show-article").css("background-image","url(../img/arrow_right.png)"),$(".aside").css("left","-250px"),$("#show-article").css("left","0px"),$(".modal").css("display","none"),$(".wrapper").css("left","0px"),setLog()):($("#show-article").css("background-image","url(../img/arrow_left.png)"),$(".aside").css("left","0px"),$("#show-article").css("left","250px"),$(".modal").css("display","block"),$(".wrapper").css("left","250px"),clearTimeout(timer))}),$articleList.click(function(e){var t=$(e.target);if(t.is(".delete")){if(confirm("确定要删除此文章吗?")){var r=t.parent("li");r.is(".active")&&(r.next().is("li")?r.next().click():r.prev().is("li")?r.prev().click():$(".new-article").click());var i=r.attr("alt");r.remove();for(var o=0;o<articleSource.length;o++)if(articleSource[o].date===i){articleSource.splice(o,1);break}}}else if(t.is("li")&&!t.is(".active")){undoLog=[],redoLog=[],$undo.attr("disabled",!0).css("background-color","#555"),$redo.attr("disabled",!0).css("background-color","#555");var i=t.attr("alt");$(".active").removeClass("active"),t.addClass("active");for(var o=0;o<articleSource.length;o++)if(articleSource[o].date===i){article=articleSource[o],articleSource.push(articleSource[o]),articleSource.splice(o,1);var c=new Date;article.date=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds(),t.attr("alt",article.date),inputTitle.value=article.title,editor.value=article.body,preview.innerHTML=md.render(editor.value);break}}articleStorage=JSON.stringify(articleSource),localStorage.setItem("article",articleStorage)});
//# sourceMappingURL=maps/main.min.js.map
