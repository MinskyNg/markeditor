!function(e){var t,a=document.getElementById("input-title"),c=document.getElementById("editor"),s=e(c),l=document.getElementById("preview"),i=e(l),r=markdownit({highlight:function(e,t){if(t&&hljs.getLanguage(t))try{return hljs.highlight(t,e).value}catch(a){}return""}}),n=e(".undo"),o=e(".redo"),d=[],u=[],f=e(".show-double"),v=e(".show-editor"),g=e(".show-preview"),b=e(".toolbar"),p=e(".form-wrapper"),h=e(".article-list"),k=/(^\s*)|(\s*$)/g;articleSpare=JSON.stringify([{title:"文章1",body:"# 文章1",date:"2016-5-20 20:41:48"},{title:"文章2",body:"# 文章2",date:"2016-5-20 20:41:49"}]);var w=localStorage.getItem("article")||articleSpare,y=JSON.parse(w),m=y[y.length-1],E=new Date;m.date=E.getFullYear()+"-"+(E.getMonth()+1)+"-"+E.getDate()+" "+E.getHours()+":"+E.getMinutes()+":"+E.getSeconds(),a.value=m.title,c.value=m.body,l.innerHTML=r.render(c.value);var S=function(){w=JSON.stringify(y),localStorage.setItem("article",w)};document.getElementById("main").style.height=document.body.clientHeight-60+"px",window.addEventListener("resize",function(){document.getElementById("main").style.height=document.body.clientHeight-60+"px"}),s.on("input propertychange",function(){l.innerHTML=r.render(c.value),u=[],o.attr("disabled",!0).css("background-color","#555"),n.attr("disabled",!1).css("background-color","#fcfcfc")});var L=function(){var e;e=this===c?l:c,e.removeEventListener("scroll",L);var t=this.scrollTop/(this.scrollHeight-this.offsetHeight);e.scrollTop=t*(e.scrollHeight-e.offsetHeight),setTimeout(function(){e.addEventListener("scroll",L)},200)};c.addEventListener("scroll",L),l.addEventListener("scroll",L);var H=function(){d[d.length-1]!==c.value&&(d.length>50&&d.shift(),d[d.length]=c.value,m.body=c.value,w=JSON.stringify(y),localStorage.setItem("article",w)),t=setTimeout(H,800)};H(),c.addEventListener("keydown",function(e){var t=e.keyCode||e.which;if(9===t){var a=c.selectionStart,s=c.selectionEnd;c.value=c.value.substring(0,a)+"	"+c.value.substring(s),c.selectionStart=c.selectionEnd=a+1,e.preventDefault(),n.attr("disabled",!1).css("background-color","#fcfcfc"),l.innerHTML=r.render(c.value)}}),document.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation();var a=new FileReader;a.onload=function(t){e(".new-article").click(),c.value=t.target.result,m.body=c.value,l.innerHTML=r.render(c.value),S()},a.readAsText(t.dataTransfer.files[0])},!1),a.addEventListener("change",function(){m.title=a.value.replace(k,"").replace(/[<>'&]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&quot;"}}),m.title=m.title||m.date;var e=m.title;e=e.length<11?e:e.substring(0,10)+"...",h.find('li[alt="'+m.date+'"]').html(e+'<a class="delete" title="删除文章"></a>'),S()}),e(".nav").click(function(p){var k=e(p.target);switch(k.attr("class")){case"new-article":case"icon-new":clearTimeout(t),d=[],u=[],n.attr("disabled",!0).css("background-color","#555"),o.attr("disabled",!0).css("background-color","#555"),m={title:"新建文章",body:"",date:""},y.push(m);var w=new Date;m.date=w.getFullYear()+"-"+(w.getMonth()+1)+"-"+w.getDate()+" "+w.getHours()+":"+w.getMinutes()+":"+w.getSeconds(),a.value=m.title,c.value=m.body,l.innerHTML=r.render(c.value),e(".active").removeClass("active"),h.prepend('<li class="active" alt="'+m.date+'" title="选择文章">'+m.title+'<a class="delete" title="删除文章"></a></li>'),H();break;case"del-article":case"icon-del":for(var E=(m.date,h.children().length),L=0;E>L;L++)e(h.children()[L]).is(".active")&&e(h.children()[L]).find(".delete").click();break;case"down-article":case"icon-download":var M=m.title+".md",T=new Blob([m.body],{type:"text/plain"});if(window.saveAs)window.saveAs(T,M);else if(navigator.saveBlob)navigator.saveBlob(T,M);else{url=URL.createObjectURL(T);var x=document.createElement("a");x.setAttribute("href",url),x.setAttribute("download",M);var p=document.createEvent("MouseEvents");p.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),x.dispatchEvent(p)}break;case"undo":case"icon-undo":u.push(d.pop()),s.val(d[d.length-1]).blur(),d[d.length-1]||n.attr("disabled",!0).css("background-color","#555"),o.attr("disabled",!1).css("background-color","#fcfcfc"),l.innerHTML=r.render(c.value),m.body=c.value,S();break;case"redo":case"icon-redo":var D=u.pop();d.push(D),u[u.length-1]||o.attr("disabled",!0).css("background-color","#555"),n.attr("disabled",!1).css("background-color","#fcfcfc"),s.val(D).blur(),l.innerHTML=r.render(c.value),m.body=c.value,S();break;case"show-double":case"icon-double":s.css({display:"block",width:"48%"}),i.css({display:"block",width:"52%"}),b.css("display","block"),f.attr("disabled",!0).css("background-color","#555"),v.attr("disabled",!1).css("background-color","#fcfcfc"),g.attr("disabled",!1).css("background-color","#fcfcfc");break;case"show-editor":case"icon-editor":s.css({display:"block",width:"100%"}),i.css({display:"none",width:"0%"}),b.css("display","block"),v.attr("disabled",!0).css("background-color","#555"),f.attr("disabled",!1).css("background-color","#fcfcfc"),g.attr("disabled",!1).css("background-color","#fcfcfc");break;case"show-preview":case"icon-preview":s.css({display:"none",width:"0%"}),i.css({display:"block",width:"100%"}),b.css("display","none"),g.attr("disabled",!0).css("background-color","#555"),v.attr("disabled",!1).css("background-color","#fcfcfc"),f.attr("disabled",!1).css("background-color","#fcfcfc");break;case"show-tips":case"icon-tips":"none"===e(".tips").css("display")?e(".tips").css("display","block"):e(".tips").css("display","none")}});var M=function(e){if(document.selection){var t=document.selection.createRange();t.text=e}else if("number"==typeof c.selectionStart&&"number"==typeof c.selectionEnd){var a=c.selectionStart,s=c.selectionEnd,i=a,o=c.value;c.value=o.substring(0,a)+e+o.substring(s,o.length),i+=e.length,"## 请输入标题"===e?(c.selectionStart=i-5,c.selectionEnd=i):"**请输入文字**"===e?(c.selectionStart=i-7,c.selectionEnd=i-2):"*请输入文字*"===e?(c.selectionStart=i-6,c.selectionEnd=i-1):"	 请输入代码"===e?(c.selectionStart=i-5,c.selectionEnd=i):"* 请输入列表项"===e?(c.selectionStart=i-6,c.selectionEnd=i):"1. 请输入列表项"===e?(c.selectionStart=i-6,c.selectionEnd=i):"> 请输入引用"===e?(c.selectionStart=i-5,c.selectionEnd=i):c.selectionStart=c.selectionEnd=i}else c.value+=e;c.focus(),n.attr("disabled",!1).css("background-color","#fcfcfc"),l.innerHTML=r.render(c.value)},T=function(t){p.css("display","block"),p.click(function(a){var s=e(a.target);if(s.is(".cancel"))e(".form-wrapper input").val(""),p.css("display","none"),p.off("click keydown"),a.preventDefault(),c.focus();else if(s.is(".submit")){var i=e(".input-word").val().replace(k,""),o=e(".input-address").val().replace(k,"");M("img"===t?"!["+i+"]("+o+")":"["+i+"]("+o+")"),e(".form-wrapper input").val(""),p.css("display","none"),p.off("click keydown"),n.attr("disabled",!1).css("background-color","#fcfcfc"),l.innerHTML=r.render(c.value),a.preventDefault(),c.focus()}}),p.keydown(function(a){var s=a.keyCode||a.which;if(13===s){var i=e(".input-word").val().replace(k,""),n=e(".input-address").val().replace(k,"");M("img"===t?"!["+i+"]("+n+")":"["+i+"]("+n+")"),e(".form-wrapper input").val(""),p.css("display","none"),p.off("click keydown"),l.innerHTML=r.render(c.value),a.preventDefault(),c.focus()}})};b.click(function(t){var a=e(t.target);switch(a.attr("class")){case"add-heading":case"icon-heading":M("## 请输入标题");break;case"add-strong":case"icon-strong":M("**请输入文字**");break;case"add-italic":case"icon-italic":M("*请输入文字*");break;case"add-code":case"icon-code":M("	 请输入代码");break;case"add-link":case"icon-link":T("link");break;case"add-img":case"icon-img":T("img");break;case"add-ul":case"icon-ul":M("* 请输入列表项");break;case"add-ol":case"icon-ol":M("1. 请输入列表项");break;case"add-quote":case"icon-quote":M("> 请输入引用");break;case"add-line":case"icon-line":M("----------")}}),function(){for(var t=y.length-1;t>=0;t--){var a=y[t],c=a.title;c=c.length<11?c:c.substring(0,10)+"...",h.append('<li alt="'+a.date+'" title="选择文章">'+c+'<a class="delete" title="删除文章"></a></li>')}e(".article-list li:first-child").addClass("active")}(),e("#show-article").click(function(){"0px"===e(".aside").css("left")?(e(".icon-arrow_left").removeClass("icon-arrow_left").addClass("icon-arrow_right"),e(".aside").css("left","-250px"),e("#show-article").css("left","0px"),e(".modal").css("display","none"),e(".wrapper").css("left","0px"),H()):(e(".icon-arrow_right").removeClass("icon-arrow_right").addClass("icon-arrow_left"),e(".aside").css("left","0px"),e("#show-article").css("left","250px"),e(".modal").css("display","block"),e(".wrapper").css("left","250px"),clearTimeout(t))}),h.click(function(t){var s=e(t.target);if(s.is(".delete")){if(confirm("确定要删除此文章吗?")){var i=s.parent("li");i.is(".active")&&(i.next().is("li")?i.next().click():i.prev().is("li")?i.prev().click():e(".new-article").click());var f=i.attr("alt");i.remove();for(var v=0;v<y.length;v++)if(y[v].date===f){y.splice(v,1);break}}}else if(s.is("li")&&!s.is(".active")){d=[],u=[],n.attr("disabled",!0).css("background-color","#555"),o.attr("disabled",!0).css("background-color","#555");var f=s.attr("alt");e(".active").removeClass("active"),s.addClass("active");for(var v=0;v<y.length;v++)if(y[v].date===f){m=y[v],y.push(y[v]),y.splice(v,1);var g=new Date;m.date=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate()+" "+g.getHours()+":"+g.getMinutes()+":"+g.getSeconds(),s.attr("alt",m.date),a.value=m.title,c.value=m.body,l.innerHTML=r.render(c.value);break}}S()})}(jQuery);
//# sourceMappingURL=maps/main.min.js.map
