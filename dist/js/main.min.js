var inputTitle=document.getElementById("input-title"),editor=document.getElementById("editor"),$editor=$(editor),preview=document.getElementById("preview"),$preview=$(preview),md=markdownit({highlight:function(e,t){if(t&&hljs.getLanguage(t))try{return hljs.highlight(t,e).value}catch(r){}return""}}),timer,$undo=$(".undo"),$redo=$(".redo"),undoLog=[],redoLog=[],$showDouble=$(".show-double"),$showEditor=$(".show-editor"),$showPreview=$(".show-preview"),$toolbar=$(".toolbar"),$formWrapper=$(".form-wrapper"),$articleList=$(".article-list"),regTrim=/(^\s*)|(\s*$)/g;articleSpare=JSON.stringify([{title:"文章1",body:"# 文章1",date:"2016-5-20 20:41:48"},{title:"文章2",body:"# 文章2",date:"2016-5-20 20:41:49"}]);var articleStorage=localStorage.getItem("article")||articleSpare,articleSource=JSON.parse(articleStorage),article=articleSource[articleSource.length-1],now=new Date;article.date=now.getFullYear()+"-"+(now.getMonth()+1)+"-"+now.getDate()+" "+now.getHours()+":"+now.getMinutes()+":"+now.getSeconds(),inputTitle.value=article.title,editor.value=article.body,preview.innerHTML=md.render(editor.value);var saveArticle=function(){articleStorage=JSON.stringify(articleSource),localStorage.setItem("article",articleStorage)};document.getElementById("main").style.height=document.body.clientHeight-60+"px",window.addEventListener("resize",function(){document.getElementById("main").style.height=document.body.clientHeight-60+"px"}),$editor.on("input propertychange",function(){preview.innerHTML=md.render(editor.value),redoLog=[],$redo.attr("disabled",!0).css("background-color","#555"),$undo.attr("disabled",!1).css("background-color","#fcfcfc")});var handleScroll=function(){var e;e=this===editor?preview:editor,e.removeEventListener("scroll",handleScroll);var t=this.scrollTop/(this.scrollHeight-this.offsetHeight);e.scrollTop=t*(e.scrollHeight-e.offsetHeight),setTimeout(function(){e.addEventListener("scroll",handleScroll)},200)};editor.addEventListener("scroll",handleScroll),preview.addEventListener("scroll",handleScroll);var setLog=function(){undoLog[undoLog.length-1]!==editor.value&&(undoLog.length>50&&undoLog.shift(),undoLog[undoLog.length]=editor.value,article.body=editor.value,articleStorage=JSON.stringify(articleSource),localStorage.setItem("article",articleStorage)),timer=setTimeout(setLog,800)};setLog(),editor.addEventListener("keydown",function(e){var t=e.keyCode||e.which;if(9===t){var r=editor.selectionStart,i=editor.selectionEnd;editor.value=editor.value.substring(0,r)+"	"+editor.value.substring(i),editor.selectionStart=editor.selectionEnd=r+1,e.preventDefault(),$undo.attr("disabled",!1).css("background-color","#fcfcfc"),preview.innerHTML=md.render(editor.value)}}),document.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();var t=new FileReader;t.onload=function(e){$(".new-article").click(),editor.value=e.target.result,article.body=editor.value,preview.innerHTML=md.render(editor.value),saveArticle()},t.readAsText(e.dataTransfer.files[0])},!1),inputTitle.addEventListener("change",function(){article.title=inputTitle.value.replace(regTrim,"").replace(/[<>'&]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&quot;"}}),article.title=article.title||article.date;var e=article.title;e=e.length<11?e:e.substring(0,10)+"...",$articleList.find('li[alt="'+article.date+'"]').html(e+'<a class="delete" title="删除文章"></a>'),saveArticle()}),$(".nav").click(function(e){var t=$(e.target);switch(t.attr("class")){case"new-article":case"icon-new":clearTimeout(timer),undoLog=[],redoLog=[],$undo.attr("disabled",!0).css("background-color","#555"),$redo.attr("disabled",!0).css("background-color","#555"),article={title:"新建文章",body:"",date:""},articleSource.push(article);var r=new Date;article.date=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds(),inputTitle.value=article.title,editor.value=article.body,preview.innerHTML=md.render(editor.value),$(".active").removeClass("active"),$articleList.prepend('<li class="active" alt="'+article.date+'" title="选择文章">'+article.title+'<a class="delete" title="删除文章"></a></li>'),setLog();break;case"del-article":case"icon-del":for(var i=(article.date,$articleList.children().length),o=0;i>o;o++)$($articleList.children()[o]).is(".active")&&$($articleList.children()[o]).find(".delete").click();break;case"down-article":case"icon-download":var a=article.title+".md",c=new Blob([article.body],{type:"text/plain"});if(window.saveAs)window.saveAs(c,a);else if(navigator.saveBlob)navigator.saveBlob(c,a);else{url=URL.createObjectURL(c);var l=document.createElement("a");l.setAttribute("href",url),l.setAttribute("download",a);var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),l.dispatchEvent(e)}break;case"undo":case"icon-undo":redoLog.push(undoLog.pop()),$editor.val(undoLog[undoLog.length-1]).blur(),undoLog[undoLog.length-1]||$undo.attr("disabled",!0).css("background-color","#555"),$redo.attr("disabled",!1).css("background-color","#fcfcfc"),preview.innerHTML=md.render(editor.value),article.body=editor.value,saveArticle();break;case"redo":case"icon-redo":var s=redoLog.pop();undoLog.push(s),redoLog[redoLog.length-1]||$redo.attr("disabled",!0).css("background-color","#555"),$undo.attr("disabled",!1).css("background-color","#fcfcfc"),$editor.val(s).blur(),preview.innerHTML=md.render(editor.value),article.body=editor.value,saveArticle();break;case"show-double":case"icon-double":$editor.css({display:"block",width:"48%"}),$preview.css({display:"block",width:"52%"}),$toolbar.css("display","block"),$showDouble.attr("disabled",!0).css("background-color","#555"),$showEditor.attr("disabled",!1).css("background-color","#fcfcfc"),$showPreview.attr("disabled",!1).css("background-color","#fcfcfc");break;case"show-editor":case"icon-editor":$editor.css({display:"block",width:"100%"}),$preview.css({display:"none",width:"0%"}),$toolbar.css("display","block"),$showEditor.attr("disabled",!0).css("background-color","#555"),$showDouble.attr("disabled",!1).css("background-color","#fcfcfc"),$showPreview.attr("disabled",!1).css("background-color","#fcfcfc");break;case"show-preview":case"icon-preview":$editor.css({display:"none",width:"0%"}),$preview.css({display:"block",width:"100%"}),$toolbar.css("display","none"),$showPreview.attr("disabled",!0).css("background-color","#555"),$showEditor.attr("disabled",!1).css("background-color","#fcfcfc"),$showDouble.attr("disabled",!1).css("background-color","#fcfcfc");break;case"show-tips":case"icon-tips":"none"===$(".tips").css("display")?$(".tips").css("display","block"):$(".tips").css("display","none")}});var insertText=function(e){if(document.selection){var t=document.selection.createRange();t.text=e}else if("number"==typeof editor.selectionStart&&"number"==typeof editor.selectionEnd){var r=editor.selectionStart,i=editor.selectionEnd,o=r,a=editor.value;editor.value=a.substring(0,r)+e+a.substring(i,a.length),o+=e.length,"## 请输入标题"===e?(editor.selectionStart=o-5,editor.selectionEnd=o):"**请输入文字**"===e?(editor.selectionStart=o-7,editor.selectionEnd=o-2):"*请输入文字*"===e?(editor.selectionStart=o-6,editor.selectionEnd=o-1):"	 请输入代码"===e?(editor.selectionStart=o-5,editor.selectionEnd=o):"* 请输入列表项"===e?(editor.selectionStart=o-6,editor.selectionEnd=o):"1. 请输入列表项"===e?(editor.selectionStart=o-6,editor.selectionEnd=o):"> 请输入引用"===e?(editor.selectionStart=o-5,editor.selectionEnd=o):editor.selectionStart=editor.selectionEnd=o}else editor.value+=e;editor.focus(),$undo.attr("disabled",!1).css("background-color","#fcfcfc"),preview.innerHTML=md.render(editor.value)},getAddress=function(e){$formWrapper.css("display","block"),$formWrapper.click(function(t){var r=$(t.target);if(r.is(".cancel"))$(".form-wrapper input").val(""),$formWrapper.css("display","none"),$formWrapper.off("click keydown"),t.preventDefault(),editor.focus();else if(r.is(".submit")){var i=$(".input-word").val().replace(regTrim,""),o=$(".input-address").val().replace(regTrim,"");insertText("img"===e?"!["+i+"]("+o+")":"["+i+"]("+o+")"),$(".form-wrapper input").val(""),$formWrapper.css("display","none"),$formWrapper.off("click keydown"),$undo.attr("disabled",!1).css("background-color","#fcfcfc"),preview.innerHTML=md.render(editor.value),t.preventDefault(),editor.focus()}}),$formWrapper.keydown(function(t){var r=t.keyCode||t.which;if(13===r){var i=$(".input-word").val().replace(regTrim,""),o=$(".input-address").val().replace(regTrim,"");insertText("img"===e?"!["+i+"]("+o+")":"["+i+"]("+o+")"),$(".form-wrapper input").val(""),$formWrapper.css("display","none"),$formWrapper.off("click keydown"),preview.innerHTML=md.render(editor.value),t.preventDefault(),editor.focus()}})};$toolbar.click(function(e){var t=$(e.target);switch(t.attr("class")){case"add-heading":case"icon-heading":insertText("## 请输入标题");break;case"add-strong":case"icon-strong":insertText("**请输入文字**");break;case"add-italic":case"icon-italic":insertText("*请输入文字*");break;case"add-code":case"icon-code":insertText("	 请输入代码");break;case"add-link":case"icon-link":getAddress("link");break;case"add-img":case"icon-img":getAddress("img");break;case"add-ul":case"icon-ul":insertText("* 请输入列表项");break;case"add-ol":case"icon-ol":insertText("1. 请输入列表项");break;case"add-quote":case"icon-quote":insertText("> 请输入引用");break;case"add-line":case"icon-line":insertText("----------")}}),function(){for(var e=articleSource.length-1;e>=0;e--){var t=articleSource[e],r=t.title;r=r.length<11?r:r.substring(0,10)+"...",$articleList.append('<li alt="'+t.date+'" title="选择文章">'+r+'<a class="delete" title="删除文章"></a></li>')}$(".article-list li:first-child").addClass("active")}(),$("#show-article").click(function(){"0px"===$(".aside").css("left")?($(".icon-arrow_left").removeClass("icon-arrow_left").addClass("icon-arrow_right"),$(".aside").css("left","-250px"),$("#show-article").css("left","0px"),$(".modal").css("display","none"),$(".wrapper").css("left","0px"),setLog()):($(".icon-arrow_right").removeClass("icon-arrow_right").addClass("icon-arrow_left"),$(".aside").css("left","0px"),$("#show-article").css("left","250px"),$(".modal").css("display","block"),$(".wrapper").css("left","250px"),clearTimeout(timer))}),$articleList.click(function(e){var t=$(e.target);if(t.is(".delete")){if(confirm("确定要删除此文章吗?")){var r=t.parent("li");r.is(".active")&&(r.next().is("li")?r.next().click():r.prev().is("li")?r.prev().click():$(".new-article").click());var i=r.attr("alt");r.remove();for(var o=0;o<articleSource.length;o++)if(articleSource[o].date===i){articleSource.splice(o,1);break}}}else if(t.is("li")&&!t.is(".active")){undoLog=[],redoLog=[],$undo.attr("disabled",!0).css("background-color","#555"),$redo.attr("disabled",!0).css("background-color","#555");var i=t.attr("alt");$(".active").removeClass("active"),t.addClass("active");for(var o=0;o<articleSource.length;o++)if(articleSource[o].date===i){article=articleSource[o],articleSource.push(articleSource[o]),articleSource.splice(o,1);var a=new Date;article.date=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),t.attr("alt",article.date),inputTitle.value=article.title,editor.value=article.body,preview.innerHTML=md.render(editor.value);break}}saveArticle()});
//# sourceMappingURL=maps/main.min.js.map
